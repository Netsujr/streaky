  [1m[35m (8.1ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (3.4ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4137291668138766585)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
Migrating to CreateGoodJobs (20260119193213)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.7ms)[0m  [1m[35mCREATE TABLE "good_jobs" ("id" uuid DEFAULT gen_random_uuid() NOT NULL PRIMARY KEY, "queue_name" text, "priority" integer, "serialized_params" jsonb, "scheduled_at" timestamp(6), "performed_at" timestamp(6), "finished_at" timestamp(6), "error" text, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, "active_job_id" uuid, "concurrency_key" text, "cron_key" text, "retried_good_job_id" uuid, "cron_at" timestamp(6), "batch_id" uuid, "batch_callback_id" uuid, "is_discrete" boolean, "executions_count" integer, "job_class" text, "error_event" smallint, "labels" text[], "locked_by_id" uuid, "locked_at" timestamp(6))[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "good_job_batches" ("id" uuid DEFAULT gen_random_uuid() NOT NULL PRIMARY KEY, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, "description" text, "serialized_properties" jsonb, "on_finish" text, "on_success" text, "on_discard" text, "callback_queue_name" text, "callback_priority" integer, "enqueued_at" timestamp(6), "discarded_at" timestamp(6), "finished_at" timestamp(6), "jobs_finished_at" timestamp(6))[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE TABLE "good_job_executions" ("id" uuid DEFAULT gen_random_uuid() NOT NULL PRIMARY KEY, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, "active_job_id" uuid NOT NULL, "job_class" text, "queue_name" text, "serialized_params" jsonb, "scheduled_at" timestamp(6), "finished_at" timestamp(6), "error" text, "error_event" smallint, "error_backtrace" text[], "process_id" uuid, "duration" interval)[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "good_job_processes" ("id" uuid DEFAULT gen_random_uuid() NOT NULL PRIMARY KEY, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, "state" jsonb, "lock_type" smallint)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "good_job_settings" ("id" uuid DEFAULT gen_random_uuid() NOT NULL PRIMARY KEY, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, "key" text, "value" jsonb)[0m
  [1m[35m (0.6ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_good_job_settings_on_key" ON "good_job_settings" ("key")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE INDEX "index_good_jobs_on_scheduled_at" ON "good_jobs" ("scheduled_at") WHERE (finished_at IS NULL)[0m
  [1m[35m (0.4ms)[0m  [1m[35mCREATE INDEX "index_good_jobs_on_queue_name_and_scheduled_at" ON "good_jobs" ("queue_name", "scheduled_at") WHERE (finished_at IS NULL)[0m
  [1m[35m (0.6ms)[0m  [1m[35mCREATE INDEX "index_good_jobs_on_active_job_id_and_created_at" ON "good_jobs" ("active_job_id", "created_at")[0m
  [1m[35m (0.3ms)[0m  [1m[35mCREATE INDEX "index_good_jobs_on_concurrency_key_when_unfinished" ON "good_jobs" ("concurrency_key") WHERE (finished_at IS NULL)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCREATE INDEX "index_good_jobs_on_concurrency_key_and_created_at" ON "good_jobs" ("concurrency_key", "created_at")[0m
  [1m[35m (0.4ms)[0m  [1m[35mCREATE INDEX "index_good_jobs_on_cron_key_and_created_at_cond" ON "good_jobs" ("cron_key", "created_at") WHERE (cron_key IS NOT NULL)[0m
  [1m[35m (0.4ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_good_jobs_on_cron_key_and_cron_at_cond" ON "good_jobs" ("cron_key", "cron_at") WHERE (cron_key IS NOT NULL)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCREATE INDEX "index_good_jobs_jobs_on_finished_at_only" ON "good_jobs" ("finished_at") WHERE finished_at IS NOT NULL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCREATE INDEX "index_good_jobs_jobs_on_priority_created_at_when_unfinished" ON "good_jobs" ("priority" DESC NULLS LAST, "created_at" ASC) WHERE finished_at IS NULL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCREATE INDEX "index_good_job_jobs_for_candidate_lookup" ON "good_jobs" ("priority" ASC NULLS LAST, "created_at" ASC) WHERE finished_at IS NULL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCREATE INDEX "index_good_jobs_on_batch_id" ON "good_jobs" ("batch_id") WHERE batch_id IS NOT NULL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCREATE INDEX "index_good_jobs_on_batch_callback_id" ON "good_jobs" ("batch_callback_id") WHERE batch_callback_id IS NOT NULL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCREATE INDEX "index_good_jobs_on_job_class" ON "good_jobs" ("job_class")[0m
  [1m[35m (0.6ms)[0m  [1m[35mCREATE INDEX "index_good_jobs_on_labels" ON "good_jobs" USING gin ("labels") WHERE (labels IS NOT NULL)[0m
  [1m[35m (0.4ms)[0m  [1m[35mCREATE INDEX "index_good_job_executions_on_active_job_id_and_created_at" ON "good_job_executions" ("active_job_id", "created_at")[0m
  [1m[35m (0.4ms)[0m  [1m[35mCREATE INDEX "index_good_jobs_on_priority_scheduled_at_unfinished_unlocked" ON "good_jobs" ("priority" ASC NULLS LAST, "scheduled_at" ASC) WHERE finished_at IS NULL AND locked_by_id IS NULL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCREATE INDEX "index_good_jobs_on_locked_by_id" ON "good_jobs" ("locked_by_id") WHERE locked_by_id IS NOT NULL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCREATE INDEX "index_good_job_executions_on_process_id_and_created_at" ON "good_job_executions" ("process_id", "created_at")[0m
  [1m[36mActiveRecord::SchemaMigration Create (1.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20260119193213"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateUsers (20260119193219)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.9ms)[0m  [1m[35mCREATE TABLE "users" ("id" bigserial primary key, "name" character varying NOT NULL, "email" character varying NOT NULL, "password_digest" character varying NOT NULL, "timezone" character varying DEFAULT 'America/Sao_Paulo' NOT NULL, "weekly_summary_enabled" boolean DEFAULT TRUE NOT NULL, "reminders_enabled" boolean DEFAULT TRUE NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.4ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20260119193219"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateHabits (20260119193459)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.2ms)[0m  [1m[35mCREATE TABLE "habits" ("id" bigserial primary key, "user_id" bigint NOT NULL, "name" character varying(60) NOT NULL, "goal_per_week" integer DEFAULT 7 NOT NULL, "start_date" date NOT NULL, "archived_at" timestamp(6), "color" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_541267aaf9"
FOREIGN KEY ("user_id")
  REFERENCES "users" ("id")
)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCREATE INDEX "index_habits_on_user_id" ON "habits" ("user_id")[0m
  [1m[35m (0.4ms)[0m  [1m[35mCREATE INDEX "index_habits_on_user_id_and_archived_at" ON "habits" ("user_id", "archived_at")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20260119193459"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateCheckins (20260119193504)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE TABLE "checkins" ("id" bigserial primary key, "habit_id" bigint NOT NULL, "user_id" bigint NOT NULL, "occurred_on" date NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_83a809b5ed"
FOREIGN KEY ("habit_id")
  REFERENCES "habits" ("id")
, CONSTRAINT "fk_rails_4b2b85ec8b"
FOREIGN KEY ("user_id")
  REFERENCES "users" ("id")
)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCREATE INDEX "index_checkins_on_habit_id" ON "checkins" ("habit_id")[0m
  [1m[35m (0.3ms)[0m  [1m[35mCREATE INDEX "index_checkins_on_user_id" ON "checkins" ("user_id")[0m
  [1m[35m (0.4ms)[0m  [1m[35mCREATE INDEX "index_checkins_on_user_id_and_occurred_on" ON "checkins" ("user_id", "occurred_on")[0m
  [1m[35m (0.3ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_checkins_on_habit_id_and_occurred_on" ON "checkins" ("habit_id", "occurred_on")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20260119193504"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Create (0.6ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "key"[0m  [["key", "environment"], ["value", "test"], ["created_at", "2026-01-19 19:42:50.073115"], ["updated_at", "2026-01-19 19:42:50.073115"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT pg_advisory_unlock(4137291668138766585)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (1.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.9ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (42.9ms)[0m  [1m[35mDROP DATABASE IF EXISTS "streaky_test"[0m
  [1m[35m (37.1ms)[0m  [1m[35mCREATE DATABASE "streaky_test" ENCODING = 'unicode'[0m
  [1m[35mSQL (0.4ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "checkins" CASCADE[0m
  [1m[35m (3.2ms)[0m  [1m[35mCREATE TABLE "checkins" ("id" bigserial primary key, "habit_id" bigint NOT NULL, "user_id" bigint NOT NULL, "occurred_on" date NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.6ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_checkins_on_habit_id_and_occurred_on" ON "checkins" ("habit_id", "occurred_on")[0m
  [1m[35m (0.3ms)[0m  [1m[35mCREATE INDEX "index_checkins_on_habit_id" ON "checkins" ("habit_id")[0m
  [1m[35m (0.3ms)[0m  [1m[35mCREATE INDEX "index_checkins_on_user_id_and_occurred_on" ON "checkins" ("user_id", "occurred_on")[0m
  [1m[35m (0.6ms)[0m  [1m[35mCREATE INDEX "index_checkins_on_user_id" ON "checkins" ("user_id")[0m
  [1m[35m (0.0ms)[0m  [1m[35mDROP TABLE IF EXISTS "good_job_batches" CASCADE[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE TABLE "good_job_batches" ("id" uuid DEFAULT gen_random_uuid() NOT NULL PRIMARY KEY, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, "description" text, "serialized_properties" jsonb, "on_finish" text, "on_success" text, "on_discard" text, "callback_queue_name" text, "callback_priority" integer, "enqueued_at" timestamp(6), "discarded_at" timestamp(6), "finished_at" timestamp(6), "jobs_finished_at" timestamp(6))[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "good_job_executions" CASCADE[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "good_job_executions" ("id" uuid DEFAULT gen_random_uuid() NOT NULL PRIMARY KEY, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, "active_job_id" uuid NOT NULL, "job_class" text, "queue_name" text, "serialized_params" jsonb, "scheduled_at" timestamp(6), "finished_at" timestamp(6), "error" text, "error_event" smallint, "error_backtrace" text[], "process_id" uuid, "duration" interval)[0m
  [1m[35m (0.4ms)[0m  [1m[35mCREATE INDEX "index_good_job_executions_on_active_job_id_and_created_at" ON "good_job_executions" ("active_job_id", "created_at")[0m
  [1m[35m (0.3ms)[0m  [1m[35mCREATE INDEX "index_good_job_executions_on_process_id_and_created_at" ON "good_job_executions" ("process_id", "created_at")[0m
  [1m[35m (0.0ms)[0m  [1m[35mDROP TABLE IF EXISTS "good_job_processes" CASCADE[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "good_job_processes" ("id" uuid DEFAULT gen_random_uuid() NOT NULL PRIMARY KEY, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, "state" jsonb, "lock_type" smallint)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "good_job_settings" CASCADE[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "good_job_settings" ("id" uuid DEFAULT gen_random_uuid() NOT NULL PRIMARY KEY, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, "key" text, "value" jsonb)[0m
  [1m[35m (0.5ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_good_job_settings_on_key" ON "good_job_settings" ("key")[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "good_jobs" CASCADE[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE TABLE "good_jobs" ("id" uuid DEFAULT gen_random_uuid() NOT NULL PRIMARY KEY, "queue_name" text, "priority" integer, "serialized_params" jsonb, "scheduled_at" timestamp(6), "performed_at" timestamp(6), "finished_at" timestamp(6), "error" text, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, "active_job_id" uuid, "concurrency_key" text, "cron_key" text, "retried_good_job_id" uuid, "cron_at" timestamp(6), "batch_id" uuid, "batch_callback_id" uuid, "is_discrete" boolean, "executions_count" integer, "job_class" text, "error_event" smallint, "labels" text[], "locked_by_id" uuid, "locked_at" timestamp(6))[0m
  [1m[35m (0.4ms)[0m  [1m[35mCREATE INDEX "index_good_jobs_on_active_job_id_and_created_at" ON "good_jobs" ("active_job_id", "created_at")[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE INDEX "index_good_jobs_on_batch_callback_id" ON "good_jobs" ("batch_callback_id") WHERE (batch_callback_id IS NOT NULL)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCREATE INDEX "index_good_jobs_on_batch_id" ON "good_jobs" ("batch_id") WHERE (batch_id IS NOT NULL)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCREATE INDEX "index_good_jobs_on_concurrency_key_and_created_at" ON "good_jobs" ("concurrency_key", "created_at")[0m
  [1m[35m (0.4ms)[0m  [1m[35mCREATE INDEX "index_good_jobs_on_concurrency_key_when_unfinished" ON "good_jobs" ("concurrency_key") WHERE (finished_at IS NULL)[0m
  [1m[35m (0.6ms)[0m  [1m[35mCREATE INDEX "index_good_jobs_on_cron_key_and_created_at_cond" ON "good_jobs" ("cron_key", "created_at") WHERE (cron_key IS NOT NULL)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_good_jobs_on_cron_key_and_cron_at_cond" ON "good_jobs" ("cron_key", "cron_at") WHERE (cron_key IS NOT NULL)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCREATE INDEX "index_good_jobs_jobs_on_finished_at_only" ON "good_jobs" ("finished_at") WHERE (finished_at IS NOT NULL)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCREATE INDEX "index_good_jobs_on_job_class" ON "good_jobs" ("job_class")[0m
  [1m[35m (0.5ms)[0m  [1m[35mCREATE INDEX "index_good_jobs_on_labels" ON "good_jobs" USING gin ("labels") WHERE (labels IS NOT NULL)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCREATE INDEX "index_good_jobs_on_locked_by_id" ON "good_jobs" ("locked_by_id") WHERE (locked_by_id IS NOT NULL)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCREATE INDEX "index_good_job_jobs_for_candidate_lookup" ON "good_jobs" ("priority", "created_at") WHERE (finished_at IS NULL)[0m
  [1m[35m (0.4ms)[0m  [1m[35mCREATE INDEX "index_good_jobs_jobs_on_priority_created_at_when_unfinished" ON "good_jobs" ("priority" DESC NULLS LAST, "created_at") WHERE (finished_at IS NULL)[0m
  [1m[35m (0.5ms)[0m  [1m[35mCREATE INDEX "index_good_jobs_on_priority_scheduled_at_unfinished_unlocked" ON "good_jobs" ("priority", "scheduled_at") WHERE ((finished_at IS NULL) AND (locked_by_id IS NULL))[0m
  [1m[35m (0.5ms)[0m  [1m[35mCREATE INDEX "index_good_jobs_on_queue_name_and_scheduled_at" ON "good_jobs" ("queue_name", "scheduled_at") WHERE (finished_at IS NULL)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCREATE INDEX "index_good_jobs_on_scheduled_at" ON "good_jobs" ("scheduled_at") WHERE (finished_at IS NULL)[0m
  [1m[35m (0.0ms)[0m  [1m[35mDROP TABLE IF EXISTS "habits" CASCADE[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "habits" ("id" bigserial primary key, "user_id" bigint NOT NULL, "name" character varying(60) NOT NULL, "goal_per_week" integer DEFAULT 7 NOT NULL, "start_date" date NOT NULL, "archived_at" timestamp(6), "color" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.4ms)[0m  [1m[35mCREATE INDEX "index_habits_on_user_id_and_archived_at" ON "habits" ("user_id", "archived_at")[0m
  [1m[35m (0.3ms)[0m  [1m[35mCREATE INDEX "index_habits_on_user_id" ON "habits" ("user_id")[0m
  [1m[35m (0.0ms)[0m  [1m[35mDROP TABLE IF EXISTS "users" CASCADE[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "users" ("id" bigserial primary key, "name" character varying NOT NULL, "email" character varying NOT NULL, "password_digest" character varying NOT NULL, "timezone" character varying DEFAULT 'America/Sao_Paulo' NOT NULL, "weekly_summary_enabled" boolean DEFAULT TRUE NOT NULL, "reminders_enabled" boolean DEFAULT TRUE NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.4ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (2.3ms)[0m  [1m[35mALTER TABLE "checkins" ADD CONSTRAINT "fk_rails_83a809b5ed"
FOREIGN KEY ("habit_id")
  REFERENCES "habits" ("id")
[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER TABLE "checkins" ADD CONSTRAINT "fk_rails_4b2b85ec8b"
FOREIGN KEY ("user_id")
  REFERENCES "users" ("id")
[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "habits" ADD CONSTRAINT "fk_rails_541267aaf9"
FOREIGN KEY ("user_id")
  REFERENCES "users" ("id")
[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.6ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20260119193504)[0m
  [1m[35m (0.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20260119193213),
(20260119193219),
(20260119193459);

[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Create (0.7ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "key"[0m  [["key", "environment"], ["value", "test"], ["created_at", "2026-01-19 19:42:59.532216"], ["updated_at", "2026-01-19 19:42:59.532216"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Create (0.1ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "key"[0m  [["key", "schema_sha1"], ["value", "80d02108ee0fde1cfa9eeacb751749255572eb80"], ["created_at", "2026-01-19 19:42:59.535814"], ["updated_at", "2026-01-19 19:42:59.535814"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.5ms)[0m  [1m[35mALTER TABLE "good_job_batches" DISABLE TRIGGER ALL;ALTER TABLE "good_job_executions" DISABLE TRIGGER ALL;ALTER TABLE "good_job_processes" DISABLE TRIGGER ALL;ALTER TABLE "good_job_settings" DISABLE TRIGGER ALL;ALTER TABLE "good_jobs" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "habits" DISABLE TRIGGER ALL;ALTER TABLE "checkins" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (5.2ms)[0m  [1m[31mDELETE FROM "checkins";
DELETE FROM "habits";
DELETE FROM "users";
INSERT INTO "checkins" ("id", "habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES (980190962, 980190962, 980190962, '2026-01-19', '2026-01-19 19:42:59.728149', '2026-01-19 19:42:59.728149'), (298486374, 298486374, 298486374, '2026-01-19', '2026-01-19 19:42:59.728149', '2026-01-19 19:42:59.728149');
INSERT INTO "habits" ("id", "user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES (980190962, 980190962, 'MyString', 1, '2026-01-19', '2026-01-19 16:34:59', 'MyString', '2026-01-19 19:42:59.741727', '2026-01-19 19:42:59.741727'), (298486374, 298486374, 'MyString', 1, '2026-01-19', '2026-01-19 16:34:59', 'MyString', '2026-01-19 19:42:59.741727', '2026-01-19 19:42:59.741727');
INSERT INTO "users" ("id", "name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES (980190962, 'MyString', 'MyString', 'MyString', 'MyString', FALSE, FALSE, '2026-01-19 19:42:59.743509', '2026-01-19 19:42:59.743509'), (298486374, 'MyString', 'MyString', 'MyString', 'MyString', FALSE, FALSE, '2026-01-19 19:42:59.743509', '2026-01-19 19:42:59.743509')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "good_job_batches" DISABLE TRIGGER ALL;ALTER TABLE "good_job_executions" DISABLE TRIGGER ALL;ALTER TABLE "good_job_processes" DISABLE TRIGGER ALL;ALTER TABLE "good_job_settings" DISABLE TRIGGER ALL;ALTER TABLE "good_jobs" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "habits" DISABLE TRIGGER ALL;ALTER TABLE "checkins" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[31mDELETE FROM "checkins";
DELETE FROM "habits";
DELETE FROM "users";
INSERT INTO "checkins" ("id", "habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES (980190962, 980190962, 980190962, '2026-01-19', '2026-01-19 19:42:59.756317', '2026-01-19 19:42:59.756317'), (298486374, 298486374, 298486374, '2026-01-19', '2026-01-19 19:42:59.756317', '2026-01-19 19:42:59.756317');
INSERT INTO "habits" ("id", "user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES (980190962, 980190962, 'MyString', 1, '2026-01-19', '2026-01-19 16:34:59', 'MyString', '2026-01-19 19:42:59.756351', '2026-01-19 19:42:59.756351'), (298486374, 298486374, 'MyString', 1, '2026-01-19', '2026-01-19 16:34:59', 'MyString', '2026-01-19 19:42:59.756351', '2026-01-19 19:42:59.756351');
INSERT INTO "users" ("id", "name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES (980190962, 'MyString', 'MyString', 'MyString', 'MyString', FALSE, FALSE, '2026-01-19 19:42:59.756372', '2026-01-19 19:42:59.756372'), (298486374, 'MyString', 'MyString', 'MyString', 'MyString', FALSE, FALSE, '2026-01-19 19:42:59.756372', '2026-01-19 19:42:59.756372')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (1.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------
StreakCalculatorTest: test_calculates_longest_streak_correctly
--------------------------------------------------------------
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (1.8ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (2.5ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-01-19 19:43:17.799348"], ["updated_at", "2026-01-19 19:43:17.799348"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (1.2ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 1], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2025-12-20"], ["archived_at", nil], ["color", nil], ["created_at", "2026-01-19 19:43:17.816936"], ["updated_at", "2026-01-19 19:43:17.816936"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-09"], ["habit_id", 1], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.3ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 1], ["user_id", 1], ["occurred_on", "2026-01-09"], ["created_at", "2026-01-19 19:43:17.826846"], ["updated_at", "2026-01-19 19:43:17.826846"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-10"], ["habit_id", 1], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.2ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 1], ["user_id", 1], ["occurred_on", "2026-01-10"], ["created_at", "2026-01-19 19:43:17.827988"], ["updated_at", "2026-01-19 19:43:17.827988"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-11"], ["habit_id", 1], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.2ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 1], ["user_id", 1], ["occurred_on", "2026-01-11"], ["created_at", "2026-01-19 19:43:17.828913"], ["updated_at", "2026-01-19 19:43:17.828913"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-13"], ["habit_id", 1], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.1ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 1], ["user_id", 1], ["occurred_on", "2026-01-13"], ["created_at", "2026-01-19 19:43:17.829817"], ["updated_at", "2026-01-19 19:43:17.829817"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-14"], ["habit_id", 1], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.1ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 1], ["user_id", 1], ["occurred_on", "2026-01-14"], ["created_at", "2026-01-19 19:43:17.830625"], ["updated_at", "2026-01-19 19:43:17.830625"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCheckin Pluck (1.4ms)[0m  [1m[34mSELECT "checkins"."occurred_on" FROM "checkins" WHERE "checkins"."habit_id" = $1 AND (occurred_on <= '2026-01-19')[0m  [["habit_id", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
StreakCalculatorTest: test_uses_user_timezone_for_today_calculation
-------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-01-19 19:43:17.837689"], ["updated_at", "2026-01-19 19:43:17.837689"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.1ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 2], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2025-12-20"], ["archived_at", nil], ["color", nil], ["created_at", "2026-01-19 19:43:17.838446"], ["updated_at", "2026-01-19 19:43:17.838446"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "utc@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.4ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "UTC User"], ["email", "utc@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "UTC"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-01-19 19:43:17.840882"], ["updated_at", "2026-01-19 19:43:17.840882"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.1ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 3], ["name", "UTC Habit"], ["goal_per_week", 7], ["start_date", "2025-12-20"], ["archived_at", nil], ["color", nil], ["created_at", "2026-01-19 19:43:17.841741"], ["updated_at", "2026-01-19 19:43:17.841741"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-19"], ["habit_id", 3], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.1ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 3], ["user_id", 3], ["occurred_on", "2026-01-19"], ["created_at", "2026-01-19 19:43:17.842846"], ["updated_at", "2026-01-19 19:43:17.842846"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCheckin Pluck (0.2ms)[0m  [1m[34mSELECT "checkins"."occurred_on" FROM "checkins" WHERE "checkins"."habit_id" = $1 AND (occurred_on <= '2026-01-19')[0m  [["habit_id", 3]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------
StreakCalculatorTest: test_calculates_current_streak_correctly
--------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-01-19 19:43:17.845823"], ["updated_at", "2026-01-19 19:43:17.845823"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.2ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 4], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2025-12-20"], ["archived_at", nil], ["color", nil], ["created_at", "2026-01-19 19:43:17.846570"], ["updated_at", "2026-01-19 19:43:17.846570"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-19"], ["habit_id", 4], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.3ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 4], ["user_id", 4], ["occurred_on", "2026-01-19"], ["created_at", "2026-01-19 19:43:17.847787"], ["updated_at", "2026-01-19 19:43:17.847787"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-18"], ["habit_id", 4], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.2ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 4], ["user_id", 4], ["occurred_on", "2026-01-18"], ["created_at", "2026-01-19 19:43:17.849002"], ["updated_at", "2026-01-19 19:43:17.849002"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-17"], ["habit_id", 4], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.3ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 4], ["user_id", 4], ["occurred_on", "2026-01-17"], ["created_at", "2026-01-19 19:43:17.850327"], ["updated_at", "2026-01-19 19:43:17.850327"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCheckin Pluck (0.2ms)[0m  [1m[34mSELECT "checkins"."occurred_on" FROM "checkins" WHERE "checkins"."habit_id" = $1 AND (occurred_on <= '2026-01-19')[0m  [["habit_id", 4]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------
StreakCalculatorTest: test_completion_rate_calculation_for_last_7_days
----------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-01-19 19:43:17.853275"], ["updated_at", "2026-01-19 19:43:17.853275"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.3ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 5], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2025-12-20"], ["archived_at", nil], ["color", nil], ["created_at", "2026-01-19 19:43:17.853912"], ["updated_at", "2026-01-19 19:43:17.853912"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-19"], ["habit_id", 5], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.3ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 5], ["user_id", 5], ["occurred_on", "2026-01-19"], ["created_at", "2026-01-19 19:43:17.855222"], ["updated_at", "2026-01-19 19:43:17.855222"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-18"], ["habit_id", 5], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.4ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 5], ["user_id", 5], ["occurred_on", "2026-01-18"], ["created_at", "2026-01-19 19:43:17.856800"], ["updated_at", "2026-01-19 19:43:17.856800"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-17"], ["habit_id", 5], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.3ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 5], ["user_id", 5], ["occurred_on", "2026-01-17"], ["created_at", "2026-01-19 19:43:17.858146"], ["updated_at", "2026-01-19 19:43:17.858146"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCheckin Pluck (0.5ms)[0m  [1m[34mSELECT "checkins"."occurred_on" FROM "checkins" WHERE "checkins"."habit_id" = $1 AND (occurred_on >= '2026-01-13')[0m  [["habit_id", 5]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------
StreakCalculatorTest: test_returns_zero_when_no_checkins_exist
--------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-01-19 19:43:17.861440"], ["updated_at", "2026-01-19 19:43:17.861440"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.2ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 6], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2025-12-20"], ["archived_at", nil], ["color", nil], ["created_at", "2026-01-19 19:43:17.862040"], ["updated_at", "2026-01-19 19:43:17.862040"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCheckin Pluck (0.3ms)[0m  [1m[34mSELECT "checkins"."occurred_on" FROM "checkins" WHERE "checkins"."habit_id" = $1 AND (occurred_on <= '2026-01-19')[0m  [["habit_id", 6]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
StreakCalculatorTest: test_handles_gaps_in_streak_correctly
-----------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-01-19 19:43:17.865224"], ["updated_at", "2026-01-19 19:43:17.865224"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.2ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 7], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2025-12-20"], ["archived_at", nil], ["color", nil], ["created_at", "2026-01-19 19:43:17.865892"], ["updated_at", "2026-01-19 19:43:17.865892"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-19"], ["habit_id", 7], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.2ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 7], ["user_id", 7], ["occurred_on", "2026-01-19"], ["created_at", "2026-01-19 19:43:17.867004"], ["updated_at", "2026-01-19 19:43:17.867004"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-18"], ["habit_id", 7], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.1ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 7], ["user_id", 7], ["occurred_on", "2026-01-18"], ["created_at", "2026-01-19 19:43:17.867927"], ["updated_at", "2026-01-19 19:43:17.867927"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-14"], ["habit_id", 7], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.2ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 7], ["user_id", 7], ["occurred_on", "2026-01-14"], ["created_at", "2026-01-19 19:43:17.868815"], ["updated_at", "2026-01-19 19:43:17.868815"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCheckin Pluck (0.2ms)[0m  [1m[34mSELECT "checkins"."occurred_on" FROM "checkins" WHERE "checkins"."habit_id" = $1 AND (occurred_on <= '2026-01-19')[0m  [["habit_id", 7]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
StreakCalculatorTest: test_calculates_longest_streak_when_all_consecutive
-------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-01-19 19:43:17.872204"], ["updated_at", "2026-01-19 19:43:17.872204"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.2ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 8], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2025-12-20"], ["archived_at", nil], ["color", nil], ["created_at", "2026-01-19 19:43:17.872869"], ["updated_at", "2026-01-19 19:43:17.872869"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-19"], ["habit_id", 8], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.4ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 8], ["user_id", 8], ["occurred_on", "2026-01-19"], ["created_at", "2026-01-19 19:43:17.874321"], ["updated_at", "2026-01-19 19:43:17.874321"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-18"], ["habit_id", 8], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.1ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 8], ["user_id", 8], ["occurred_on", "2026-01-18"], ["created_at", "2026-01-19 19:43:17.875673"], ["updated_at", "2026-01-19 19:43:17.875673"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-17"], ["habit_id", 8], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.1ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 8], ["user_id", 8], ["occurred_on", "2026-01-17"], ["created_at", "2026-01-19 19:43:17.876516"], ["updated_at", "2026-01-19 19:43:17.876516"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-16"], ["habit_id", 8], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.2ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 8], ["user_id", 8], ["occurred_on", "2026-01-16"], ["created_at", "2026-01-19 19:43:17.877347"], ["updated_at", "2026-01-19 19:43:17.877347"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-15"], ["habit_id", 8], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.1ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 8], ["user_id", 8], ["occurred_on", "2026-01-15"], ["created_at", "2026-01-19 19:43:17.878224"], ["updated_at", "2026-01-19 19:43:17.878224"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCheckin Pluck (0.2ms)[0m  [1m[34mSELECT "checkins"."occurred_on" FROM "checkins" WHERE "checkins"."habit_id" = $1 AND (occurred_on <= '2026-01-19')[0m  [["habit_id", 8]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------
StreakCalculatorTest: test_handles_timezone_boundary_edge_case
--------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.4ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-01-19 19:43:17.881550"], ["updated_at", "2026-01-19 19:43:17.881550"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.4ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 9], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2025-12-20"], ["archived_at", nil], ["color", nil], ["created_at", "2026-01-19 19:43:17.882435"], ["updated_at", "2026-01-19 19:43:17.882435"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "sp@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "SP User"], ["email", "sp@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-01-19 19:43:17.884709"], ["updated_at", "2026-01-19 19:43:17.884709"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.1ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 10], ["name", "SP Habit"], ["goal_per_week", 7], ["start_date", "2025-12-20"], ["archived_at", nil], ["color", nil], ["created_at", "2026-01-19 19:43:17.885221"], ["updated_at", "2026-01-19 19:43:17.885221"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-19"], ["habit_id", 10], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.1ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 10], ["user_id", 10], ["occurred_on", "2026-01-19"], ["created_at", "2026-01-19 19:43:17.886192"], ["updated_at", "2026-01-19 19:43:17.886192"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-18"], ["habit_id", 10], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.3ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 10], ["user_id", 10], ["occurred_on", "2026-01-18"], ["created_at", "2026-01-19 19:43:17.887153"], ["updated_at", "2026-01-19 19:43:17.887153"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCheckin Pluck (0.4ms)[0m  [1m[34mSELECT "checkins"."occurred_on" FROM "checkins" WHERE "checkins"."habit_id" = $1 AND (occurred_on <= '2026-01-19')[0m  [["habit_id", 10]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (1.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
--------------------------------------
CheckinTest: test_toggle_is_idempotent
--------------------------------------
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (2.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (4.0ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-01-19 19:43:24.383590"], ["updated_at", "2026-01-19 19:43:24.383590"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (1.6ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 11], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2026-01-19"], ["archived_at", nil], ["color", nil], ["created_at", "2026-01-19 19:43:24.401526"], ["updated_at", "2026-01-19 19:43:24.401526"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCheckin Load (1.3ms)[0m  [1m[34mSELECT "checkins".* FROM "checkins" WHERE "checkins"."habit_id" = $1 AND "checkins"."user_id" = $2 AND "checkins"."occurred_on" = $3 LIMIT $4[0m  [["habit_id", 11], ["user_id", 11], ["occurred_on", "2026-01-19"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-19"], ["habit_id", 11], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.7ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 11], ["user_id", 11], ["occurred_on", "2026-01-19"], ["created_at", "2026-01-19 19:43:24.415217"], ["updated_at", "2026-01-19 19:43:24.415217"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCheckin Count (2.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "checkins"[0m
  [1m[36mCheckin Load (0.6ms)[0m  [1m[34mSELECT "checkins".* FROM "checkins" WHERE "checkins"."habit_id" = $1 AND "checkins"."user_id" = $2 AND "checkins"."occurred_on" = $3 LIMIT $4[0m  [["habit_id", 11], ["user_id", 11], ["occurred_on", "2026-01-19"], ["LIMIT", 1]]
  [1m[36mCACHE Checkin Count (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "checkins"[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------
CheckinTest: test_can_destroy_and_recreate_checkin
--------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-01-19 19:43:24.423115"], ["updated_at", "2026-01-19 19:43:24.423115"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.3ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 12], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2026-01-19"], ["archived_at", nil], ["color", nil], ["created_at", "2026-01-19 19:43:24.423985"], ["updated_at", "2026-01-19 19:43:24.423985"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-19"], ["habit_id", 12], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.2ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 12], ["user_id", 12], ["occurred_on", "2026-01-19"], ["created_at", "2026-01-19 19:43:24.425545"], ["updated_at", "2026-01-19 19:43:24.425545"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Destroy (0.8ms)[0m  [1m[31mDELETE FROM "checkins" WHERE "checkins"."id" = $1[0m  [["id", 24]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-19"], ["habit_id", 12], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.5ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 12], ["user_id", 12], ["occurred_on", "2026-01-19"], ["created_at", "2026-01-19 19:43:24.427835"], ["updated_at", "2026-01-19 19:43:24.427835"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
CheckinTest: test_allows_checkins_for_same_date_on_different_habits
-------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-01-19 19:43:24.430807"], ["updated_at", "2026-01-19 19:43:24.430807"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.3ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 13], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2026-01-19"], ["archived_at", nil], ["color", nil], ["created_at", "2026-01-19 19:43:24.431568"], ["updated_at", "2026-01-19 19:43:24.431568"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.3ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 13], ["name", "Another Habit"], ["goal_per_week", 5], ["start_date", "2026-01-19"], ["archived_at", nil], ["color", nil], ["created_at", "2026-01-19 19:43:24.432385"], ["updated_at", "2026-01-19 19:43:24.432385"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-19"], ["habit_id", 13], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.3ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 13], ["user_id", 13], ["occurred_on", "2026-01-19"], ["created_at", "2026-01-19 19:43:24.433778"], ["updated_at", "2026-01-19 19:43:24.433778"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-19"], ["habit_id", 14], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.3ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 14], ["user_id", 13], ["occurred_on", "2026-01-19"], ["created_at", "2026-01-19 19:43:24.435018"], ["updated_at", "2026-01-19 19:43:24.435018"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------
CheckinTest: test_prevents_duplicate_checkins_for_same_habit_and_date
---------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.4ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-01-19 19:43:24.437741"], ["updated_at", "2026-01-19 19:43:24.437741"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.2ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 14], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2026-01-19"], ["archived_at", nil], ["color", nil], ["created_at", "2026-01-19 19:43:24.438573"], ["updated_at", "2026-01-19 19:43:24.438573"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-19"], ["habit_id", 15], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.1ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 15], ["user_id", 14], ["occurred_on", "2026-01-19"], ["created_at", "2026-01-19 19:43:24.439848"], ["updated_at", "2026-01-19 19:43:24.439848"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-19"], ["habit_id", 15], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------
CheckinTest: test_toggle_creates_checkin_when_none_exists
---------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.5ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-01-19 19:43:25.027522"], ["updated_at", "2026-01-19 19:43:25.027522"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.5ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 15], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2026-01-19"], ["archived_at", nil], ["color", nil], ["created_at", "2026-01-19 19:43:25.028641"], ["updated_at", "2026-01-19 19:43:25.028641"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCheckin Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "checkins"[0m
  [1m[36mCheckin Load (0.3ms)[0m  [1m[34mSELECT "checkins".* FROM "checkins" WHERE "checkins"."habit_id" = $1 AND "checkins"."user_id" = $2 AND "checkins"."occurred_on" = $3 LIMIT $4[0m  [["habit_id", 16], ["user_id", 15], ["occurred_on", "2026-01-19"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-19"], ["habit_id", 16], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.4ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 16], ["user_id", 15], ["occurred_on", "2026-01-19"], ["created_at", "2026-01-19 19:43:25.031720"], ["updated_at", "2026-01-19 19:43:25.031720"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCheckin Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "checkins"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
WeeklySummaryMailerTest: test_summary
-------------------------------------
WeeklySummaryMailer#summary: processed outbound mail in 10.0ms
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
StreakCalculatorTest: test_calculates_longest_streak_when_all_consecutive
-------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.4ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-01-19 19:43:25.125379"], ["updated_at", "2026-01-19 19:43:25.125379"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.3ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 16], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2025-12-20"], ["archived_at", nil], ["color", nil], ["created_at", "2026-01-19 19:43:25.126495"], ["updated_at", "2026-01-19 19:43:25.126495"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-19"], ["habit_id", 17], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.3ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 17], ["user_id", 16], ["occurred_on", "2026-01-19"], ["created_at", "2026-01-19 19:43:25.128005"], ["updated_at", "2026-01-19 19:43:25.128005"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-18"], ["habit_id", 17], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.2ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 17], ["user_id", 16], ["occurred_on", "2026-01-18"], ["created_at", "2026-01-19 19:43:25.129498"], ["updated_at", "2026-01-19 19:43:25.129498"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-17"], ["habit_id", 17], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.2ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 17], ["user_id", 16], ["occurred_on", "2026-01-17"], ["created_at", "2026-01-19 19:43:25.130410"], ["updated_at", "2026-01-19 19:43:25.130410"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-16"], ["habit_id", 17], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.2ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 17], ["user_id", 16], ["occurred_on", "2026-01-16"], ["created_at", "2026-01-19 19:43:25.131486"], ["updated_at", "2026-01-19 19:43:25.131486"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-15"], ["habit_id", 17], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.3ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 17], ["user_id", 16], ["occurred_on", "2026-01-15"], ["created_at", "2026-01-19 19:43:25.132608"], ["updated_at", "2026-01-19 19:43:25.132608"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCheckin Pluck (1.2ms)[0m  [1m[34mSELECT "checkins"."occurred_on" FROM "checkins" WHERE "checkins"."habit_id" = $1 AND (occurred_on <= '2026-01-19')[0m  [["habit_id", 17]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
StreakCalculatorTest: test_handles_gaps_in_streak_correctly
-----------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-01-19 19:43:25.138022"], ["updated_at", "2026-01-19 19:43:25.138022"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.4ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 17], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2025-12-20"], ["archived_at", nil], ["color", nil], ["created_at", "2026-01-19 19:43:25.138696"], ["updated_at", "2026-01-19 19:43:25.138696"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-19"], ["habit_id", 18], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.2ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 18], ["user_id", 17], ["occurred_on", "2026-01-19"], ["created_at", "2026-01-19 19:43:25.140089"], ["updated_at", "2026-01-19 19:43:25.140089"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-18"], ["habit_id", 18], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.3ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 18], ["user_id", 17], ["occurred_on", "2026-01-18"], ["created_at", "2026-01-19 19:43:25.141319"], ["updated_at", "2026-01-19 19:43:25.141319"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-14"], ["habit_id", 18], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.2ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 18], ["user_id", 17], ["occurred_on", "2026-01-14"], ["created_at", "2026-01-19 19:43:25.142491"], ["updated_at", "2026-01-19 19:43:25.142491"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCheckin Pluck (0.2ms)[0m  [1m[34mSELECT "checkins"."occurred_on" FROM "checkins" WHERE "checkins"."habit_id" = $1 AND (occurred_on <= '2026-01-19')[0m  [["habit_id", 18]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------
StreakCalculatorTest: test_handles_timezone_boundary_edge_case
--------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-01-19 19:43:25.145345"], ["updated_at", "2026-01-19 19:43:25.145345"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.2ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 18], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2025-12-20"], ["archived_at", nil], ["color", nil], ["created_at", "2026-01-19 19:43:25.146020"], ["updated_at", "2026-01-19 19:43:25.146020"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "sp@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "SP User"], ["email", "sp@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-01-19 19:43:25.148150"], ["updated_at", "2026-01-19 19:43:25.148150"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.3ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 19], ["name", "SP Habit"], ["goal_per_week", 7], ["start_date", "2025-12-20"], ["archived_at", nil], ["color", nil], ["created_at", "2026-01-19 19:43:25.148785"], ["updated_at", "2026-01-19 19:43:25.148785"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-19"], ["habit_id", 20], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.2ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 20], ["user_id", 19], ["occurred_on", "2026-01-19"], ["created_at", "2026-01-19 19:43:25.150309"], ["updated_at", "2026-01-19 19:43:25.150309"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-18"], ["habit_id", 20], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.2ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 20], ["user_id", 19], ["occurred_on", "2026-01-18"], ["created_at", "2026-01-19 19:43:25.151344"], ["updated_at", "2026-01-19 19:43:25.151344"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCheckin Pluck (0.2ms)[0m  [1m[34mSELECT "checkins"."occurred_on" FROM "checkins" WHERE "checkins"."habit_id" = $1 AND (occurred_on <= '2026-01-19')[0m  [["habit_id", 20]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------
StreakCalculatorTest: test_returns_zero_when_no_checkins_exist
--------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-01-19 19:43:25.154158"], ["updated_at", "2026-01-19 19:43:25.154158"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.2ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 20], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2025-12-20"], ["archived_at", nil], ["color", nil], ["created_at", "2026-01-19 19:43:25.154877"], ["updated_at", "2026-01-19 19:43:25.154877"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCheckin Pluck (0.2ms)[0m  [1m[34mSELECT "checkins"."occurred_on" FROM "checkins" WHERE "checkins"."habit_id" = $1 AND (occurred_on <= '2026-01-19')[0m  [["habit_id", 21]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------
StreakCalculatorTest: test_calculates_longest_streak_correctly
--------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-01-19 19:43:25.158016"], ["updated_at", "2026-01-19 19:43:25.158016"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.2ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 21], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2025-12-20"], ["archived_at", nil], ["color", nil], ["created_at", "2026-01-19 19:43:25.158854"], ["updated_at", "2026-01-19 19:43:25.158854"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-09"], ["habit_id", 22], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.2ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 22], ["user_id", 21], ["occurred_on", "2026-01-09"], ["created_at", "2026-01-19 19:43:25.160065"], ["updated_at", "2026-01-19 19:43:25.160065"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-10"], ["habit_id", 22], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.2ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 22], ["user_id", 21], ["occurred_on", "2026-01-10"], ["created_at", "2026-01-19 19:43:25.161113"], ["updated_at", "2026-01-19 19:43:25.161113"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-11"], ["habit_id", 22], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.2ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 22], ["user_id", 21], ["occurred_on", "2026-01-11"], ["created_at", "2026-01-19 19:43:25.162229"], ["updated_at", "2026-01-19 19:43:25.162229"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-13"], ["habit_id", 22], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.2ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 22], ["user_id", 21], ["occurred_on", "2026-01-13"], ["created_at", "2026-01-19 19:43:25.163316"], ["updated_at", "2026-01-19 19:43:25.163316"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-14"], ["habit_id", 22], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.1ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 22], ["user_id", 21], ["occurred_on", "2026-01-14"], ["created_at", "2026-01-19 19:43:25.164391"], ["updated_at", "2026-01-19 19:43:25.164391"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCheckin Pluck (0.2ms)[0m  [1m[34mSELECT "checkins"."occurred_on" FROM "checkins" WHERE "checkins"."habit_id" = $1 AND (occurred_on <= '2026-01-19')[0m  [["habit_id", 22]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------
StreakCalculatorTest: test_calculates_current_streak_correctly
--------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-01-19 19:43:25.167230"], ["updated_at", "2026-01-19 19:43:25.167230"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.2ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 22], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2025-12-20"], ["archived_at", nil], ["color", nil], ["created_at", "2026-01-19 19:43:25.167847"], ["updated_at", "2026-01-19 19:43:25.167847"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-19"], ["habit_id", 23], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.2ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 23], ["user_id", 22], ["occurred_on", "2026-01-19"], ["created_at", "2026-01-19 19:43:25.168968"], ["updated_at", "2026-01-19 19:43:25.168968"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-18"], ["habit_id", 23], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.2ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 23], ["user_id", 22], ["occurred_on", "2026-01-18"], ["created_at", "2026-01-19 19:43:25.169954"], ["updated_at", "2026-01-19 19:43:25.169954"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-17"], ["habit_id", 23], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.2ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 23], ["user_id", 22], ["occurred_on", "2026-01-17"], ["created_at", "2026-01-19 19:43:25.170951"], ["updated_at", "2026-01-19 19:43:25.170951"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCheckin Pluck (0.2ms)[0m  [1m[34mSELECT "checkins"."occurred_on" FROM "checkins" WHERE "checkins"."habit_id" = $1 AND (occurred_on <= '2026-01-19')[0m  [["habit_id", 23]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------
StreakCalculatorTest: test_completion_rate_calculation_for_last_7_days
----------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.4ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-01-19 19:43:25.174079"], ["updated_at", "2026-01-19 19:43:25.174079"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.4ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 23], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2025-12-20"], ["archived_at", nil], ["color", nil], ["created_at", "2026-01-19 19:43:25.174925"], ["updated_at", "2026-01-19 19:43:25.174925"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-19"], ["habit_id", 24], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.2ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 24], ["user_id", 23], ["occurred_on", "2026-01-19"], ["created_at", "2026-01-19 19:43:25.176271"], ["updated_at", "2026-01-19 19:43:25.176271"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-18"], ["habit_id", 24], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.2ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 24], ["user_id", 23], ["occurred_on", "2026-01-18"], ["created_at", "2026-01-19 19:43:25.177218"], ["updated_at", "2026-01-19 19:43:25.177218"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-17"], ["habit_id", 24], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.2ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 24], ["user_id", 23], ["occurred_on", "2026-01-17"], ["created_at", "2026-01-19 19:43:25.178221"], ["updated_at", "2026-01-19 19:43:25.178221"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCheckin Pluck (0.7ms)[0m  [1m[34mSELECT "checkins"."occurred_on" FROM "checkins" WHERE "checkins"."habit_id" = $1 AND (occurred_on >= '2026-01-13')[0m  [["habit_id", 24]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
StreakCalculatorTest: test_uses_user_timezone_for_today_calculation
-------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-01-19 19:43:25.181645"], ["updated_at", "2026-01-19 19:43:25.181645"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.2ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 24], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2025-12-20"], ["archived_at", nil], ["color", nil], ["created_at", "2026-01-19 19:43:25.182299"], ["updated_at", "2026-01-19 19:43:25.182299"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "utc@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "UTC User"], ["email", "utc@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "UTC"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-01-19 19:43:25.184486"], ["updated_at", "2026-01-19 19:43:25.184486"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.2ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 25], ["name", "UTC Habit"], ["goal_per_week", 7], ["start_date", "2025-12-20"], ["archived_at", nil], ["color", nil], ["created_at", "2026-01-19 19:43:25.185158"], ["updated_at", "2026-01-19 19:43:25.185158"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-19"], ["habit_id", 26], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.3ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 26], ["user_id", 25], ["occurred_on", "2026-01-19"], ["created_at", "2026-01-19 19:43:25.186470"], ["updated_at", "2026-01-19 19:43:25.186470"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCheckin Pluck (0.4ms)[0m  [1m[34mSELECT "checkins"."occurred_on" FROM "checkins" WHERE "checkins"."habit_id" = $1 AND (occurred_on <= '2026-01-19')[0m  [["habit_id", 26]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------
ReminderMailerTest: test_reminder
---------------------------------
ReminderMailer#reminder: processed outbound mail in 0.1ms
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (1.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mBEGIN[0m
---------------------------------
ReminderMailerTest: test_reminder
---------------------------------
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (2.6ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (3.1ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-01-19 19:43:48.954292"], ["updated_at", "2026-01-19 19:43:48.954292"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (1.9ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 26], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2026-01-19"], ["archived_at", nil], ["color", nil], ["created_at", "2026-01-19 19:43:48.969419"], ["updated_at", "2026-01-19 19:43:48.969419"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  Rendering layout layouts/mailer.html.erb
  Rendering reminder_mailer/reminder.html.erb within layouts/mailer
  Rendered reminder_mailer/reminder.html.erb within layouts/mailer (Duration: 2.4ms | Allocations: 1587)
  Rendered layout layouts/mailer.html.erb (Duration: 2.5ms | Allocations: 1652)
ReminderMailer#reminder: processed outbound mail in 21.9ms
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------
CheckinTest: test_prevents_duplicate_checkins_for_same_habit_and_date
---------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-01-19 19:43:48.999970"], ["updated_at", "2026-01-19 19:43:48.999970"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.4ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 27], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2026-01-19"], ["archived_at", nil], ["color", nil], ["created_at", "2026-01-19 19:43:49.000894"], ["updated_at", "2026-01-19 19:43:49.000894"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (1.4ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-19"], ["habit_id", 28], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.5ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 28], ["user_id", 27], ["occurred_on", "2026-01-19"], ["created_at", "2026-01-19 19:43:49.011489"], ["updated_at", "2026-01-19 19:43:49.011489"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-19"], ["habit_id", 28], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------
CheckinTest: test_toggle_creates_checkin_when_none_exists
---------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.4ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-01-19 19:43:49.016179"], ["updated_at", "2026-01-19 19:43:49.016179"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.2ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 28], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2026-01-19"], ["archived_at", nil], ["color", nil], ["created_at", "2026-01-19 19:43:49.017124"], ["updated_at", "2026-01-19 19:43:49.017124"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCheckin Count (1.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "checkins"[0m
  [1m[36mCheckin Load (0.3ms)[0m  [1m[34mSELECT "checkins".* FROM "checkins" WHERE "checkins"."habit_id" = $1 AND "checkins"."user_id" = $2 AND "checkins"."occurred_on" = $3 LIMIT $4[0m  [["habit_id", 29], ["user_id", 28], ["occurred_on", "2026-01-19"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-19"], ["habit_id", 29], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.3ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 29], ["user_id", 28], ["occurred_on", "2026-01-19"], ["created_at", "2026-01-19 19:43:49.021392"], ["updated_at", "2026-01-19 19:43:49.021392"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCheckin Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "checkins"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------
CheckinTest: test_can_destroy_and_recreate_checkin
--------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.4ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-01-19 19:43:49.024515"], ["updated_at", "2026-01-19 19:43:49.024515"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.2ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 29], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2026-01-19"], ["archived_at", nil], ["color", nil], ["created_at", "2026-01-19 19:43:49.025421"], ["updated_at", "2026-01-19 19:43:49.025421"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-19"], ["habit_id", 30], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.2ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 30], ["user_id", 29], ["occurred_on", "2026-01-19"], ["created_at", "2026-01-19 19:43:49.026655"], ["updated_at", "2026-01-19 19:43:49.026655"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Destroy (0.9ms)[0m  [1m[31mDELETE FROM "checkins" WHERE "checkins"."id" = $1[0m  [["id", 54]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-19"], ["habit_id", 30], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.6ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 30], ["user_id", 29], ["occurred_on", "2026-01-19"], ["created_at", "2026-01-19 19:43:49.029224"], ["updated_at", "2026-01-19 19:43:49.029224"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
CheckinTest: test_allows_checkins_for_same_date_on_different_habits
-------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-01-19 19:43:49.032153"], ["updated_at", "2026-01-19 19:43:49.032153"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.2ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 30], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2026-01-19"], ["archived_at", nil], ["color", nil], ["created_at", "2026-01-19 19:43:49.032868"], ["updated_at", "2026-01-19 19:43:49.032868"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.2ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 30], ["name", "Another Habit"], ["goal_per_week", 5], ["start_date", "2026-01-19"], ["archived_at", nil], ["color", nil], ["created_at", "2026-01-19 19:43:49.033624"], ["updated_at", "2026-01-19 19:43:49.033624"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-19"], ["habit_id", 31], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.2ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 31], ["user_id", 30], ["occurred_on", "2026-01-19"], ["created_at", "2026-01-19 19:43:49.034775"], ["updated_at", "2026-01-19 19:43:49.034775"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-19"], ["habit_id", 32], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.2ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 32], ["user_id", 30], ["occurred_on", "2026-01-19"], ["created_at", "2026-01-19 19:43:49.035759"], ["updated_at", "2026-01-19 19:43:49.035759"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------
CheckinTest: test_toggle_is_idempotent
--------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-01-19 19:43:49.038201"], ["updated_at", "2026-01-19 19:43:49.038201"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.2ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 31], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2026-01-19"], ["archived_at", nil], ["color", nil], ["created_at", "2026-01-19 19:43:49.038844"], ["updated_at", "2026-01-19 19:43:49.038844"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCheckin Load (0.1ms)[0m  [1m[34mSELECT "checkins".* FROM "checkins" WHERE "checkins"."habit_id" = $1 AND "checkins"."user_id" = $2 AND "checkins"."occurred_on" = $3 LIMIT $4[0m  [["habit_id", 33], ["user_id", 31], ["occurred_on", "2026-01-19"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-19"], ["habit_id", 33], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.3ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 33], ["user_id", 31], ["occurred_on", "2026-01-19"], ["created_at", "2026-01-19 19:43:49.040338"], ["updated_at", "2026-01-19 19:43:49.040338"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCheckin Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "checkins"[0m
  [1m[36mCheckin Load (0.8ms)[0m  [1m[34mSELECT "checkins".* FROM "checkins" WHERE "checkins"."habit_id" = $1 AND "checkins"."user_id" = $2 AND "checkins"."occurred_on" = $3 LIMIT $4[0m  [["habit_id", 33], ["user_id", 31], ["occurred_on", "2026-01-19"], ["LIMIT", 1]]
  [1m[36mCACHE Checkin Count (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "checkins"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------
StreakCalculatorTest: test_calculates_current_streak_correctly
--------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-01-19 19:43:49.044906"], ["updated_at", "2026-01-19 19:43:49.044906"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.3ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 32], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2025-12-20"], ["archived_at", nil], ["color", nil], ["created_at", "2026-01-19 19:43:49.045772"], ["updated_at", "2026-01-19 19:43:49.045772"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-19"], ["habit_id", 34], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.3ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 34], ["user_id", 32], ["occurred_on", "2026-01-19"], ["created_at", "2026-01-19 19:43:49.047103"], ["updated_at", "2026-01-19 19:43:49.047103"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-18"], ["habit_id", 34], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.1ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 34], ["user_id", 32], ["occurred_on", "2026-01-18"], ["created_at", "2026-01-19 19:43:49.048156"], ["updated_at", "2026-01-19 19:43:49.048156"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-17"], ["habit_id", 34], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.2ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 34], ["user_id", 32], ["occurred_on", "2026-01-17"], ["created_at", "2026-01-19 19:43:49.049239"], ["updated_at", "2026-01-19 19:43:49.049239"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCheckin Pluck (1.5ms)[0m  [1m[34mSELECT "checkins"."occurred_on" FROM "checkins" WHERE "checkins"."habit_id" = $1 AND (occurred_on <= '2026-01-19')[0m  [["habit_id", 34]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------
StreakCalculatorTest: test_returns_zero_when_no_checkins_exist
--------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-01-19 19:43:49.054529"], ["updated_at", "2026-01-19 19:43:49.054529"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.3ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 33], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2025-12-20"], ["archived_at", nil], ["color", nil], ["created_at", "2026-01-19 19:43:49.055329"], ["updated_at", "2026-01-19 19:43:49.055329"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCheckin Pluck (0.2ms)[0m  [1m[34mSELECT "checkins"."occurred_on" FROM "checkins" WHERE "checkins"."habit_id" = $1 AND (occurred_on <= '2026-01-19')[0m  [["habit_id", 35]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
StreakCalculatorTest: test_calculates_longest_streak_when_all_consecutive
-------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.5ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-01-19 19:43:49.058707"], ["updated_at", "2026-01-19 19:43:49.058707"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.3ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 34], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2025-12-20"], ["archived_at", nil], ["color", nil], ["created_at", "2026-01-19 19:43:49.059699"], ["updated_at", "2026-01-19 19:43:49.059699"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-19"], ["habit_id", 36], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.3ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 36], ["user_id", 34], ["occurred_on", "2026-01-19"], ["created_at", "2026-01-19 19:43:49.061064"], ["updated_at", "2026-01-19 19:43:49.061064"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-18"], ["habit_id", 36], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.3ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 36], ["user_id", 34], ["occurred_on", "2026-01-18"], ["created_at", "2026-01-19 19:43:49.062717"], ["updated_at", "2026-01-19 19:43:49.062717"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-17"], ["habit_id", 36], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.3ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 36], ["user_id", 34], ["occurred_on", "2026-01-17"], ["created_at", "2026-01-19 19:43:49.064015"], ["updated_at", "2026-01-19 19:43:49.064015"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-16"], ["habit_id", 36], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.2ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 36], ["user_id", 34], ["occurred_on", "2026-01-16"], ["created_at", "2026-01-19 19:43:49.065045"], ["updated_at", "2026-01-19 19:43:49.065045"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-15"], ["habit_id", 36], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.3ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 36], ["user_id", 34], ["occurred_on", "2026-01-15"], ["created_at", "2026-01-19 19:43:49.066221"], ["updated_at", "2026-01-19 19:43:49.066221"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCheckin Pluck (0.3ms)[0m  [1m[34mSELECT "checkins"."occurred_on" FROM "checkins" WHERE "checkins"."habit_id" = $1 AND (occurred_on <= '2026-01-19')[0m  [["habit_id", 36]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------
StreakCalculatorTest: test_calculates_longest_streak_correctly
--------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-01-19 19:43:49.069654"], ["updated_at", "2026-01-19 19:43:49.069654"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.2ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 35], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2025-12-20"], ["archived_at", nil], ["color", nil], ["created_at", "2026-01-19 19:43:49.070339"], ["updated_at", "2026-01-19 19:43:49.070339"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-09"], ["habit_id", 37], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.2ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 37], ["user_id", 35], ["occurred_on", "2026-01-09"], ["created_at", "2026-01-19 19:43:49.071556"], ["updated_at", "2026-01-19 19:43:49.071556"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-10"], ["habit_id", 37], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.1ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 37], ["user_id", 35], ["occurred_on", "2026-01-10"], ["created_at", "2026-01-19 19:43:49.072648"], ["updated_at", "2026-01-19 19:43:49.072648"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-11"], ["habit_id", 37], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.3ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 37], ["user_id", 35], ["occurred_on", "2026-01-11"], ["created_at", "2026-01-19 19:43:49.073499"], ["updated_at", "2026-01-19 19:43:49.073499"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-13"], ["habit_id", 37], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.4ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 37], ["user_id", 35], ["occurred_on", "2026-01-13"], ["created_at", "2026-01-19 19:43:49.074807"], ["updated_at", "2026-01-19 19:43:49.074807"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-14"], ["habit_id", 37], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.3ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 37], ["user_id", 35], ["occurred_on", "2026-01-14"], ["created_at", "2026-01-19 19:43:49.076157"], ["updated_at", "2026-01-19 19:43:49.076157"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCheckin Pluck (0.3ms)[0m  [1m[34mSELECT "checkins"."occurred_on" FROM "checkins" WHERE "checkins"."habit_id" = $1 AND (occurred_on <= '2026-01-19')[0m  [["habit_id", 37]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------
StreakCalculatorTest: test_completion_rate_calculation_for_last_7_days
----------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-01-19 19:43:49.079608"], ["updated_at", "2026-01-19 19:43:49.079608"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.2ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 36], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2025-12-20"], ["archived_at", nil], ["color", nil], ["created_at", "2026-01-19 19:43:49.080310"], ["updated_at", "2026-01-19 19:43:49.080310"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-19"], ["habit_id", 38], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.2ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 38], ["user_id", 36], ["occurred_on", "2026-01-19"], ["created_at", "2026-01-19 19:43:49.081427"], ["updated_at", "2026-01-19 19:43:49.081427"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-18"], ["habit_id", 38], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.3ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 38], ["user_id", 36], ["occurred_on", "2026-01-18"], ["created_at", "2026-01-19 19:43:49.082450"], ["updated_at", "2026-01-19 19:43:49.082450"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-17"], ["habit_id", 38], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.3ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 38], ["user_id", 36], ["occurred_on", "2026-01-17"], ["created_at", "2026-01-19 19:43:49.083848"], ["updated_at", "2026-01-19 19:43:49.083848"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCheckin Pluck (0.7ms)[0m  [1m[34mSELECT "checkins"."occurred_on" FROM "checkins" WHERE "checkins"."habit_id" = $1 AND (occurred_on >= '2026-01-13')[0m  [["habit_id", 38]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------
StreakCalculatorTest: test_handles_timezone_boundary_edge_case
--------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-01-19 19:43:49.087821"], ["updated_at", "2026-01-19 19:43:49.087821"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.3ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 37], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2025-12-20"], ["archived_at", nil], ["color", nil], ["created_at", "2026-01-19 19:43:49.088566"], ["updated_at", "2026-01-19 19:43:49.088566"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "sp@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.4ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "SP User"], ["email", "sp@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-01-19 19:43:49.091118"], ["updated_at", "2026-01-19 19:43:49.091118"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.4ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 38], ["name", "SP Habit"], ["goal_per_week", 7], ["start_date", "2025-12-20"], ["archived_at", nil], ["color", nil], ["created_at", "2026-01-19 19:43:49.091959"], ["updated_at", "2026-01-19 19:43:49.091959"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-19"], ["habit_id", 40], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.3ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 40], ["user_id", 38], ["occurred_on", "2026-01-19"], ["created_at", "2026-01-19 19:43:49.093464"], ["updated_at", "2026-01-19 19:43:49.093464"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-18"], ["habit_id", 40], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.3ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 40], ["user_id", 38], ["occurred_on", "2026-01-18"], ["created_at", "2026-01-19 19:43:49.094608"], ["updated_at", "2026-01-19 19:43:49.094608"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCheckin Pluck (0.3ms)[0m  [1m[34mSELECT "checkins"."occurred_on" FROM "checkins" WHERE "checkins"."habit_id" = $1 AND (occurred_on <= '2026-01-19')[0m  [["habit_id", 40]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
StreakCalculatorTest: test_uses_user_timezone_for_today_calculation
-------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-01-19 19:43:49.097700"], ["updated_at", "2026-01-19 19:43:49.097700"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.1ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 39], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2025-12-20"], ["archived_at", nil], ["color", nil], ["created_at", "2026-01-19 19:43:49.098277"], ["updated_at", "2026-01-19 19:43:49.098277"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "utc@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "UTC User"], ["email", "utc@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "UTC"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-01-19 19:43:49.100416"], ["updated_at", "2026-01-19 19:43:49.100416"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.2ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 40], ["name", "UTC Habit"], ["goal_per_week", 7], ["start_date", "2025-12-20"], ["archived_at", nil], ["color", nil], ["created_at", "2026-01-19 19:43:49.101040"], ["updated_at", "2026-01-19 19:43:49.101040"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-19"], ["habit_id", 42], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.3ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 42], ["user_id", 40], ["occurred_on", "2026-01-19"], ["created_at", "2026-01-19 19:43:49.102227"], ["updated_at", "2026-01-19 19:43:49.102227"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCheckin Pluck (0.3ms)[0m  [1m[34mSELECT "checkins"."occurred_on" FROM "checkins" WHERE "checkins"."habit_id" = $1 AND (occurred_on <= '2026-01-19')[0m  [["habit_id", 42]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
StreakCalculatorTest: test_handles_gaps_in_streak_correctly
-----------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-01-19 19:43:49.105135"], ["updated_at", "2026-01-19 19:43:49.105135"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.1ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 41], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2025-12-20"], ["archived_at", nil], ["color", nil], ["created_at", "2026-01-19 19:43:49.105865"], ["updated_at", "2026-01-19 19:43:49.105865"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-19"], ["habit_id", 43], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.3ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 43], ["user_id", 41], ["occurred_on", "2026-01-19"], ["created_at", "2026-01-19 19:43:49.106947"], ["updated_at", "2026-01-19 19:43:49.106947"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-18"], ["habit_id", 43], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.3ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 43], ["user_id", 41], ["occurred_on", "2026-01-18"], ["created_at", "2026-01-19 19:43:49.108237"], ["updated_at", "2026-01-19 19:43:49.108237"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-14"], ["habit_id", 43], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.2ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 43], ["user_id", 41], ["occurred_on", "2026-01-14"], ["created_at", "2026-01-19 19:43:49.109367"], ["updated_at", "2026-01-19 19:43:49.109367"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCheckin Pluck (0.3ms)[0m  [1m[34mSELECT "checkins"."occurred_on" FROM "checkins" WHERE "checkins"."habit_id" = $1 AND (occurred_on <= '2026-01-19')[0m  [["habit_id", 43]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
WeeklySummaryMailerTest: test_summary
-------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-01-19 19:43:49.112808"], ["updated_at", "2026-01-19 19:43:49.112808"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.3ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 42], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2026-01-19"], ["archived_at", nil], ["color", nil], ["created_at", "2026-01-19 19:43:49.113517"], ["updated_at", "2026-01-19 19:43:49.113517"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  Rendering layout layouts/mailer.html.erb
  Rendering weekly_summary_mailer/summary.html.erb within layouts/mailer
  Rendered weekly_summary_mailer/summary.html.erb within layouts/mailer (Duration: 0.7ms | Allocations: 542)
  Rendered layout layouts/mailer.html.erb (Duration: 0.8ms | Allocations: 585)
WeeklySummaryMailer#summary: processed outbound mail in 1.5ms
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (1.2ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
WeeklySummaryMailerTest: test_summary
-------------------------------------
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (3.0ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (4.3ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-01-19 19:43:54.276686"], ["updated_at", "2026-01-19 19:43:54.276686"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (1.5ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 43], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2026-01-19"], ["archived_at", nil], ["color", nil], ["created_at", "2026-01-19 19:43:54.293503"], ["updated_at", "2026-01-19 19:43:54.293503"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  Rendering layout layouts/mailer.html.erb
  Rendering weekly_summary_mailer/summary.html.erb within layouts/mailer
  Rendered weekly_summary_mailer/summary.html.erb within layouts/mailer (Duration: 1.3ms | Allocations: 1104)
  Rendered layout layouts/mailer.html.erb (Duration: 1.4ms | Allocations: 1169)
WeeklySummaryMailer#summary: processed outbound mail in 13.1ms
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (1.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
WeeklySummaryMailerTest: test_summary
-------------------------------------
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (2.6ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (4.8ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-01-19 19:44:02.757002"], ["updated_at", "2026-01-19 19:44:02.757002"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (1.7ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 44], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2026-01-19"], ["archived_at", nil], ["color", nil], ["created_at", "2026-01-19 19:44:02.775749"], ["updated_at", "2026-01-19 19:44:02.775749"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  Rendering layout layouts/mailer.html.erb
  Rendering weekly_summary_mailer/summary.html.erb within layouts/mailer
  Rendered weekly_summary_mailer/summary.html.erb within layouts/mailer (Duration: 1.1ms | Allocations: 815)
  Rendered layout layouts/mailer.html.erb (Duration: 1.4ms | Allocations: 1023)
  Rendering layout layouts/mailer.text.erb
  Rendering weekly_summary_mailer/summary.text.erb within layouts/mailer
  Rendered weekly_summary_mailer/summary.text.erb within layouts/mailer (Duration: 0.3ms | Allocations: 401)
  Rendered layout layouts/mailer.text.erb (Duration: 0.5ms | Allocations: 550)
WeeklySummaryMailer#summary: processed outbound mail in 15.6ms
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------
CheckinTest: test_can_destroy_and_recreate_checkin
--------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.5ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-01-19 19:44:02.803038"], ["updated_at", "2026-01-19 19:44:02.803038"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.4ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 45], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2026-01-19"], ["archived_at", nil], ["color", nil], ["created_at", "2026-01-19 19:44:02.804166"], ["updated_at", "2026-01-19 19:44:02.804166"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-19"], ["habit_id", 47], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.9ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 47], ["user_id", 45], ["occurred_on", "2026-01-19"], ["created_at", "2026-01-19 19:44:02.815422"], ["updated_at", "2026-01-19 19:44:02.815422"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Destroy (1.2ms)[0m  [1m[31mDELETE FROM "checkins" WHERE "checkins"."id" = $1[0m  [["id", 81]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-19"], ["habit_id", 47], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.7ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 47], ["user_id", 45], ["occurred_on", "2026-01-19"], ["created_at", "2026-01-19 19:44:02.819248"], ["updated_at", "2026-01-19 19:44:02.819248"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------
CheckinTest: test_toggle_is_idempotent
--------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-01-19 19:44:02.822743"], ["updated_at", "2026-01-19 19:44:02.822743"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.3ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 46], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2026-01-19"], ["archived_at", nil], ["color", nil], ["created_at", "2026-01-19 19:44:02.823420"], ["updated_at", "2026-01-19 19:44:02.823420"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCheckin Load (0.4ms)[0m  [1m[34mSELECT "checkins".* FROM "checkins" WHERE "checkins"."habit_id" = $1 AND "checkins"."user_id" = $2 AND "checkins"."occurred_on" = $3 LIMIT $4[0m  [["habit_id", 48], ["user_id", 46], ["occurred_on", "2026-01-19"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-19"], ["habit_id", 48], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.3ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 48], ["user_id", 46], ["occurred_on", "2026-01-19"], ["created_at", "2026-01-19 19:44:02.826318"], ["updated_at", "2026-01-19 19:44:02.826318"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCheckin Count (2.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "checkins"[0m
  [1m[36mCheckin Load (1.2ms)[0m  [1m[34mSELECT "checkins".* FROM "checkins" WHERE "checkins"."habit_id" = $1 AND "checkins"."user_id" = $2 AND "checkins"."occurred_on" = $3 LIMIT $4[0m  [["habit_id", 48], ["user_id", 46], ["occurred_on", "2026-01-19"], ["LIMIT", 1]]
  [1m[36mCACHE Checkin Count (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "checkins"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
CheckinTest: test_allows_checkins_for_same_date_on_different_habits
-------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.5ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-01-19 19:44:02.833309"], ["updated_at", "2026-01-19 19:44:02.833309"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.3ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 47], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2026-01-19"], ["archived_at", nil], ["color", nil], ["created_at", "2026-01-19 19:44:02.834322"], ["updated_at", "2026-01-19 19:44:02.834322"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.3ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 47], ["name", "Another Habit"], ["goal_per_week", 5], ["start_date", "2026-01-19"], ["archived_at", nil], ["color", nil], ["created_at", "2026-01-19 19:44:02.835171"], ["updated_at", "2026-01-19 19:44:02.835171"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-19"], ["habit_id", 49], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.4ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 49], ["user_id", 47], ["occurred_on", "2026-01-19"], ["created_at", "2026-01-19 19:44:02.836570"], ["updated_at", "2026-01-19 19:44:02.836570"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-19"], ["habit_id", 50], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.2ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 50], ["user_id", 47], ["occurred_on", "2026-01-19"], ["created_at", "2026-01-19 19:44:02.837913"], ["updated_at", "2026-01-19 19:44:02.837913"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------
CheckinTest: test_toggle_creates_checkin_when_none_exists
---------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.4ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-01-19 19:44:02.840617"], ["updated_at", "2026-01-19 19:44:02.840617"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.4ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 48], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2026-01-19"], ["archived_at", nil], ["color", nil], ["created_at", "2026-01-19 19:44:02.841481"], ["updated_at", "2026-01-19 19:44:02.841481"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCheckin Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "checkins"[0m
  [1m[36mCheckin Load (0.2ms)[0m  [1m[34mSELECT "checkins".* FROM "checkins" WHERE "checkins"."habit_id" = $1 AND "checkins"."user_id" = $2 AND "checkins"."occurred_on" = $3 LIMIT $4[0m  [["habit_id", 51], ["user_id", 48], ["occurred_on", "2026-01-19"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-19"], ["habit_id", 51], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.3ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 51], ["user_id", 48], ["occurred_on", "2026-01-19"], ["created_at", "2026-01-19 19:44:02.843921"], ["updated_at", "2026-01-19 19:44:02.843921"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCheckin Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "checkins"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------
CheckinTest: test_prevents_duplicate_checkins_for_same_habit_and_date
---------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.7ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-01-19 19:44:02.846866"], ["updated_at", "2026-01-19 19:44:02.846866"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.2ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 49], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2026-01-19"], ["archived_at", nil], ["color", nil], ["created_at", "2026-01-19 19:44:02.848002"], ["updated_at", "2026-01-19 19:44:02.848002"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-19"], ["habit_id", 52], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.2ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 52], ["user_id", 49], ["occurred_on", "2026-01-19"], ["created_at", "2026-01-19 19:44:02.849182"], ["updated_at", "2026-01-19 19:44:02.849182"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-19"], ["habit_id", 52], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------
StreakCalculatorTest: test_calculates_longest_streak_correctly
--------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-01-19 19:44:02.852923"], ["updated_at", "2026-01-19 19:44:02.852923"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.2ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 50], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2025-12-20"], ["archived_at", nil], ["color", nil], ["created_at", "2026-01-19 19:44:02.853608"], ["updated_at", "2026-01-19 19:44:02.853608"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-09"], ["habit_id", 53], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.2ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 53], ["user_id", 50], ["occurred_on", "2026-01-09"], ["created_at", "2026-01-19 19:44:02.854818"], ["updated_at", "2026-01-19 19:44:02.854818"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-10"], ["habit_id", 53], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.1ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 53], ["user_id", 50], ["occurred_on", "2026-01-10"], ["created_at", "2026-01-19 19:44:02.855988"], ["updated_at", "2026-01-19 19:44:02.855988"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-11"], ["habit_id", 53], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.3ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 53], ["user_id", 50], ["occurred_on", "2026-01-11"], ["created_at", "2026-01-19 19:44:02.856823"], ["updated_at", "2026-01-19 19:44:02.856823"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-13"], ["habit_id", 53], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.3ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 53], ["user_id", 50], ["occurred_on", "2026-01-13"], ["created_at", "2026-01-19 19:44:02.858213"], ["updated_at", "2026-01-19 19:44:02.858213"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-14"], ["habit_id", 53], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.2ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 53], ["user_id", 50], ["occurred_on", "2026-01-14"], ["created_at", "2026-01-19 19:44:02.859508"], ["updated_at", "2026-01-19 19:44:02.859508"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCheckin Pluck (0.8ms)[0m  [1m[34mSELECT "checkins"."occurred_on" FROM "checkins" WHERE "checkins"."habit_id" = $1 AND (occurred_on <= '2026-01-19')[0m  [["habit_id", 53]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
StreakCalculatorTest: test_handles_gaps_in_streak_correctly
-----------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-01-19 19:44:02.864765"], ["updated_at", "2026-01-19 19:44:02.864765"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.3ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 51], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2025-12-20"], ["archived_at", nil], ["color", nil], ["created_at", "2026-01-19 19:44:02.865569"], ["updated_at", "2026-01-19 19:44:02.865569"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-19"], ["habit_id", 54], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.2ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 54], ["user_id", 51], ["occurred_on", "2026-01-19"], ["created_at", "2026-01-19 19:44:02.867120"], ["updated_at", "2026-01-19 19:44:02.867120"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-18"], ["habit_id", 54], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.3ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 54], ["user_id", 51], ["occurred_on", "2026-01-18"], ["created_at", "2026-01-19 19:44:02.868270"], ["updated_at", "2026-01-19 19:44:02.868270"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-14"], ["habit_id", 54], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.3ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 54], ["user_id", 51], ["occurred_on", "2026-01-14"], ["created_at", "2026-01-19 19:44:02.869546"], ["updated_at", "2026-01-19 19:44:02.869546"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCheckin Pluck (0.3ms)[0m  [1m[34mSELECT "checkins"."occurred_on" FROM "checkins" WHERE "checkins"."habit_id" = $1 AND (occurred_on <= '2026-01-19')[0m  [["habit_id", 54]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------
StreakCalculatorTest: test_calculates_current_streak_correctly
--------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-01-19 19:44:02.872908"], ["updated_at", "2026-01-19 19:44:02.872908"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.3ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 52], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2025-12-20"], ["archived_at", nil], ["color", nil], ["created_at", "2026-01-19 19:44:02.873538"], ["updated_at", "2026-01-19 19:44:02.873538"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-19"], ["habit_id", 55], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.3ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 55], ["user_id", 52], ["occurred_on", "2026-01-19"], ["created_at", "2026-01-19 19:44:02.875044"], ["updated_at", "2026-01-19 19:44:02.875044"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-18"], ["habit_id", 55], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.2ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 55], ["user_id", 52], ["occurred_on", "2026-01-18"], ["created_at", "2026-01-19 19:44:02.876267"], ["updated_at", "2026-01-19 19:44:02.876267"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-17"], ["habit_id", 55], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.3ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 55], ["user_id", 52], ["occurred_on", "2026-01-17"], ["created_at", "2026-01-19 19:44:02.877475"], ["updated_at", "2026-01-19 19:44:02.877475"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCheckin Pluck (0.3ms)[0m  [1m[34mSELECT "checkins"."occurred_on" FROM "checkins" WHERE "checkins"."habit_id" = $1 AND (occurred_on <= '2026-01-19')[0m  [["habit_id", 55]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------
StreakCalculatorTest: test_completion_rate_calculation_for_last_7_days
----------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-01-19 19:44:02.880827"], ["updated_at", "2026-01-19 19:44:02.880827"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.2ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 53], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2025-12-20"], ["archived_at", nil], ["color", nil], ["created_at", "2026-01-19 19:44:02.881602"], ["updated_at", "2026-01-19 19:44:02.881602"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-19"], ["habit_id", 56], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.3ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 56], ["user_id", 53], ["occurred_on", "2026-01-19"], ["created_at", "2026-01-19 19:44:02.882886"], ["updated_at", "2026-01-19 19:44:02.882886"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-18"], ["habit_id", 56], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.4ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 56], ["user_id", 53], ["occurred_on", "2026-01-18"], ["created_at", "2026-01-19 19:44:02.884441"], ["updated_at", "2026-01-19 19:44:02.884441"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-17"], ["habit_id", 56], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.2ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 56], ["user_id", 53], ["occurred_on", "2026-01-17"], ["created_at", "2026-01-19 19:44:02.885761"], ["updated_at", "2026-01-19 19:44:02.885761"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCheckin Pluck (0.7ms)[0m  [1m[34mSELECT "checkins"."occurred_on" FROM "checkins" WHERE "checkins"."habit_id" = $1 AND (occurred_on >= '2026-01-13')[0m  [["habit_id", 56]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
StreakCalculatorTest: test_calculates_longest_streak_when_all_consecutive
-------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-01-19 19:44:02.889512"], ["updated_at", "2026-01-19 19:44:02.889512"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.4ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 54], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2025-12-20"], ["archived_at", nil], ["color", nil], ["created_at", "2026-01-19 19:44:02.890063"], ["updated_at", "2026-01-19 19:44:02.890063"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-19"], ["habit_id", 57], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.3ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 57], ["user_id", 54], ["occurred_on", "2026-01-19"], ["created_at", "2026-01-19 19:44:02.891605"], ["updated_at", "2026-01-19 19:44:02.891605"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-18"], ["habit_id", 57], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.3ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 57], ["user_id", 54], ["occurred_on", "2026-01-18"], ["created_at", "2026-01-19 19:44:02.892898"], ["updated_at", "2026-01-19 19:44:02.892898"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-17"], ["habit_id", 57], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.2ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 57], ["user_id", 54], ["occurred_on", "2026-01-17"], ["created_at", "2026-01-19 19:44:02.894134"], ["updated_at", "2026-01-19 19:44:02.894134"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-16"], ["habit_id", 57], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.2ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 57], ["user_id", 54], ["occurred_on", "2026-01-16"], ["created_at", "2026-01-19 19:44:02.895215"], ["updated_at", "2026-01-19 19:44:02.895215"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-15"], ["habit_id", 57], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.2ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 57], ["user_id", 54], ["occurred_on", "2026-01-15"], ["created_at", "2026-01-19 19:44:02.896532"], ["updated_at", "2026-01-19 19:44:02.896532"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCheckin Pluck (0.3ms)[0m  [1m[34mSELECT "checkins"."occurred_on" FROM "checkins" WHERE "checkins"."habit_id" = $1 AND (occurred_on <= '2026-01-19')[0m  [["habit_id", 57]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------
StreakCalculatorTest: test_returns_zero_when_no_checkins_exist
--------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.4ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-01-19 19:44:02.899790"], ["updated_at", "2026-01-19 19:44:02.899790"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.3ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 55], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2025-12-20"], ["archived_at", nil], ["color", nil], ["created_at", "2026-01-19 19:44:02.900627"], ["updated_at", "2026-01-19 19:44:02.900627"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCheckin Pluck (0.2ms)[0m  [1m[34mSELECT "checkins"."occurred_on" FROM "checkins" WHERE "checkins"."habit_id" = $1 AND (occurred_on <= '2026-01-19')[0m  [["habit_id", 58]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------
StreakCalculatorTest: test_handles_timezone_boundary_edge_case
--------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-01-19 19:44:02.903798"], ["updated_at", "2026-01-19 19:44:02.903798"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.3ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 56], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2025-12-20"], ["archived_at", nil], ["color", nil], ["created_at", "2026-01-19 19:44:02.904579"], ["updated_at", "2026-01-19 19:44:02.904579"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "sp@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "SP User"], ["email", "sp@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-01-19 19:44:02.906841"], ["updated_at", "2026-01-19 19:44:02.906841"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.4ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 57], ["name", "SP Habit"], ["goal_per_week", 7], ["start_date", "2025-12-20"], ["archived_at", nil], ["color", nil], ["created_at", "2026-01-19 19:44:02.907596"], ["updated_at", "2026-01-19 19:44:02.907596"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-19"], ["habit_id", 60], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.3ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 60], ["user_id", 57], ["occurred_on", "2026-01-19"], ["created_at", "2026-01-19 19:44:02.909170"], ["updated_at", "2026-01-19 19:44:02.909170"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-18"], ["habit_id", 60], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.3ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 60], ["user_id", 57], ["occurred_on", "2026-01-18"], ["created_at", "2026-01-19 19:44:02.910364"], ["updated_at", "2026-01-19 19:44:02.910364"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCheckin Pluck (0.2ms)[0m  [1m[34mSELECT "checkins"."occurred_on" FROM "checkins" WHERE "checkins"."habit_id" = $1 AND (occurred_on <= '2026-01-19')[0m  [["habit_id", 60]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
StreakCalculatorTest: test_uses_user_timezone_for_today_calculation
-------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-01-19 19:44:02.913543"], ["updated_at", "2026-01-19 19:44:02.913543"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.2ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 58], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2025-12-20"], ["archived_at", nil], ["color", nil], ["created_at", "2026-01-19 19:44:02.914307"], ["updated_at", "2026-01-19 19:44:02.914307"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "utc@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "UTC User"], ["email", "utc@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "UTC"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-01-19 19:44:02.916549"], ["updated_at", "2026-01-19 19:44:02.916549"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.3ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 59], ["name", "UTC Habit"], ["goal_per_week", 7], ["start_date", "2025-12-20"], ["archived_at", nil], ["color", nil], ["created_at", "2026-01-19 19:44:02.917334"], ["updated_at", "2026-01-19 19:44:02.917334"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-19"], ["habit_id", 62], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.3ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 62], ["user_id", 59], ["occurred_on", "2026-01-19"], ["created_at", "2026-01-19 19:44:02.918679"], ["updated_at", "2026-01-19 19:44:02.918679"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCheckin Pluck (0.2ms)[0m  [1m[34mSELECT "checkins"."occurred_on" FROM "checkins" WHERE "checkins"."habit_id" = $1 AND (occurred_on <= '2026-01-19')[0m  [["habit_id", 62]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------
ReminderMailerTest: test_reminder
---------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-01-19 19:44:02.922278"], ["updated_at", "2026-01-19 19:44:02.922278"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.1ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 60], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2026-01-19"], ["archived_at", nil], ["color", nil], ["created_at", "2026-01-19 19:44:02.922980"], ["updated_at", "2026-01-19 19:44:02.922980"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  Rendering layout layouts/mailer.html.erb
  Rendering reminder_mailer/reminder.html.erb within layouts/mailer
  Rendered reminder_mailer/reminder.html.erb within layouts/mailer (Duration: 0.4ms | Allocations: 373)
  Rendered layout layouts/mailer.html.erb (Duration: 0.4ms | Allocations: 429)
  Rendering layout layouts/mailer.text.erb
  Rendering reminder_mailer/reminder.text.erb within layouts/mailer
  Rendered reminder_mailer/reminder.text.erb within layouts/mailer (Duration: 0.3ms | Allocations: 281)
  Rendered layout layouts/mailer.text.erb (Duration: 0.3ms | Allocations: 329)
ReminderMailer#reminder: processed outbound mail in 2.1ms
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (1.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
StreakCalculatorTest: test_uses_user_timezone_for_today_calculation
-------------------------------------------------------------------
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (2.8ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (4.2ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-02-02 17:27:32.997549"], ["updated_at", "2026-02-02 17:27:32.997549"]]
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (5.7ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 1], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2026-01-03"], ["archived_at", nil], ["color", nil], ["created_at", "2026-02-02 17:27:33.103592"], ["updated_at", "2026-02-02 17:27:33.103592"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "utc@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.7ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "UTC User"], ["email", "utc@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "UTC"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-02-02 17:27:33.116536"], ["updated_at", "2026-02-02 17:27:33.116536"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (1.4ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 2], ["name", "UTC Habit"], ["goal_per_week", 7], ["start_date", "2026-01-03"], ["archived_at", nil], ["color", nil], ["created_at", "2026-02-02 17:27:33.118369"], ["updated_at", "2026-02-02 17:27:33.118369"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (1.8ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-02-02"], ["habit_id", 2], ["LIMIT", 1]]
  [1m[36mCheckin Create (5.6ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 2], ["user_id", 2], ["occurred_on", "2026-02-02"], ["created_at", "2026-02-02 17:27:33.150559"], ["updated_at", "2026-02-02 17:27:33.150559"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCheckin Pluck (1.1ms)[0m  [1m[34mSELECT "checkins"."occurred_on" FROM "checkins" WHERE "checkins"."habit_id" = $1 AND (occurred_on <= '2026-02-02')[0m  [["habit_id", 2]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------
StreakCalculatorTest: test_completion_rate_calculation_for_last_7_days
----------------------------------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.7ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-02-02 17:27:33.167985"], ["updated_at", "2026-02-02 17:27:33.167985"]]
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.8ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 3], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2026-01-03"], ["archived_at", nil], ["color", nil], ["created_at", "2026-02-02 17:27:33.172875"], ["updated_at", "2026-02-02 17:27:33.172875"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-02-02"], ["habit_id", 3], ["LIMIT", 1]]
  [1m[36mCheckin Create (1.3ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 3], ["user_id", 3], ["occurred_on", "2026-02-02"], ["created_at", "2026-02-02 17:27:33.176514"], ["updated_at", "2026-02-02 17:27:33.176514"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-02-01"], ["habit_id", 3], ["LIMIT", 1]]
  [1m[36mCheckin Create (1.2ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 3], ["user_id", 3], ["occurred_on", "2026-02-01"], ["created_at", "2026-02-02 17:27:33.182355"], ["updated_at", "2026-02-02 17:27:33.182355"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-31"], ["habit_id", 3], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.5ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 3], ["user_id", 3], ["occurred_on", "2026-01-31"], ["created_at", "2026-02-02 17:27:33.187873"], ["updated_at", "2026-02-02 17:27:33.187873"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCheckin Pluck (1.2ms)[0m  [1m[34mSELECT "checkins"."occurred_on" FROM "checkins" WHERE "checkins"."habit_id" = $1 AND (occurred_on >= '2026-01-27')[0m  [["habit_id", 3]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------
StreakCalculatorTest: test_calculates_current_streak_correctly
--------------------------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.6ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-02-02 17:27:33.201556"], ["updated_at", "2026-02-02 17:27:33.201556"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (1.1ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 4], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2026-01-03"], ["archived_at", nil], ["color", nil], ["created_at", "2026-02-02 17:27:33.205795"], ["updated_at", "2026-02-02 17:27:33.205795"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-02-02"], ["habit_id", 4], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.8ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 4], ["user_id", 4], ["occurred_on", "2026-02-02"], ["created_at", "2026-02-02 17:27:33.213489"], ["updated_at", "2026-02-02 17:27:33.213489"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-02-01"], ["habit_id", 4], ["LIMIT", 1]]
  [1m[36mCheckin Create (1.1ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 4], ["user_id", 4], ["occurred_on", "2026-02-01"], ["created_at", "2026-02-02 17:27:33.216853"], ["updated_at", "2026-02-02 17:27:33.216853"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-31"], ["habit_id", 4], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.5ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 4], ["user_id", 4], ["occurred_on", "2026-01-31"], ["created_at", "2026-02-02 17:27:33.223210"], ["updated_at", "2026-02-02 17:27:33.223210"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCheckin Pluck (0.7ms)[0m  [1m[34mSELECT "checkins"."occurred_on" FROM "checkins" WHERE "checkins"."habit_id" = $1 AND (occurred_on <= '2026-02-02')[0m  [["habit_id", 4]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
StreakCalculatorTest: test_calculates_longest_streak_when_all_consecutive
-------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.5ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-02-02 17:27:33.231392"], ["updated_at", "2026-02-02 17:27:33.231392"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.6ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 5], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2026-01-03"], ["archived_at", nil], ["color", nil], ["created_at", "2026-02-02 17:27:33.233154"], ["updated_at", "2026-02-02 17:27:33.233154"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-02-02"], ["habit_id", 5], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.4ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 5], ["user_id", 5], ["occurred_on", "2026-02-02"], ["created_at", "2026-02-02 17:27:33.239097"], ["updated_at", "2026-02-02 17:27:33.239097"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-02-01"], ["habit_id", 5], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.7ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 5], ["user_id", 5], ["occurred_on", "2026-02-01"], ["created_at", "2026-02-02 17:27:33.242334"], ["updated_at", "2026-02-02 17:27:33.242334"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-31"], ["habit_id", 5], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.5ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 5], ["user_id", 5], ["occurred_on", "2026-01-31"], ["created_at", "2026-02-02 17:27:33.245712"], ["updated_at", "2026-02-02 17:27:33.245712"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-30"], ["habit_id", 5], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.4ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 5], ["user_id", 5], ["occurred_on", "2026-01-30"], ["created_at", "2026-02-02 17:27:33.247930"], ["updated_at", "2026-02-02 17:27:33.247930"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-29"], ["habit_id", 5], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.3ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 5], ["user_id", 5], ["occurred_on", "2026-01-29"], ["created_at", "2026-02-02 17:27:33.249246"], ["updated_at", "2026-02-02 17:27:33.249246"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCheckin Pluck (0.2ms)[0m  [1m[34mSELECT "checkins"."occurred_on" FROM "checkins" WHERE "checkins"."habit_id" = $1 AND (occurred_on <= '2026-02-02')[0m  [["habit_id", 5]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------
StreakCalculatorTest: test_returns_zero_when_no_checkins_exist
--------------------------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.5ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-02-02 17:27:33.253230"], ["updated_at", "2026-02-02 17:27:33.253230"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.7ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 6], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2026-01-03"], ["archived_at", nil], ["color", nil], ["created_at", "2026-02-02 17:27:33.254764"], ["updated_at", "2026-02-02 17:27:33.254764"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCheckin Pluck (0.4ms)[0m  [1m[34mSELECT "checkins"."occurred_on" FROM "checkins" WHERE "checkins"."habit_id" = $1 AND (occurred_on <= '2026-02-02')[0m  [["habit_id", 6]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
StreakCalculatorTest: test_handles_gaps_in_streak_correctly
-----------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-02-02 17:27:33.261155"], ["updated_at", "2026-02-02 17:27:33.261155"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.3ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 7], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2026-01-03"], ["archived_at", nil], ["color", nil], ["created_at", "2026-02-02 17:27:33.262043"], ["updated_at", "2026-02-02 17:27:33.262043"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-02-02"], ["habit_id", 7], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.4ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 7], ["user_id", 7], ["occurred_on", "2026-02-02"], ["created_at", "2026-02-02 17:27:33.264041"], ["updated_at", "2026-02-02 17:27:33.264041"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-02-01"], ["habit_id", 7], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.3ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 7], ["user_id", 7], ["occurred_on", "2026-02-01"], ["created_at", "2026-02-02 17:27:33.265841"], ["updated_at", "2026-02-02 17:27:33.265841"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-28"], ["habit_id", 7], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.2ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 7], ["user_id", 7], ["occurred_on", "2026-01-28"], ["created_at", "2026-02-02 17:27:33.266905"], ["updated_at", "2026-02-02 17:27:33.266905"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCheckin Pluck (0.2ms)[0m  [1m[34mSELECT "checkins"."occurred_on" FROM "checkins" WHERE "checkins"."habit_id" = $1 AND (occurred_on <= '2026-02-02')[0m  [["habit_id", 7]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------
StreakCalculatorTest: test_handles_timezone_boundary_edge_case
--------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.6ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-02-02 17:27:33.270357"], ["updated_at", "2026-02-02 17:27:33.270357"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.3ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 8], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2026-01-03"], ["archived_at", nil], ["color", nil], ["created_at", "2026-02-02 17:27:33.272071"], ["updated_at", "2026-02-02 17:27:33.272071"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "sp@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "SP User"], ["email", "sp@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-02-02 17:27:33.274445"], ["updated_at", "2026-02-02 17:27:33.274445"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.3ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 9], ["name", "SP Habit"], ["goal_per_week", 7], ["start_date", "2026-01-03"], ["archived_at", nil], ["color", nil], ["created_at", "2026-02-02 17:27:33.275046"], ["updated_at", "2026-02-02 17:27:33.275046"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-02-02"], ["habit_id", 9], ["LIMIT", 1]]
  [1m[36mCheckin Create (1.2ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 9], ["user_id", 9], ["occurred_on", "2026-02-02"], ["created_at", "2026-02-02 17:27:33.276410"], ["updated_at", "2026-02-02 17:27:33.276410"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-02-01"], ["habit_id", 9], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.3ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 9], ["user_id", 9], ["occurred_on", "2026-02-01"], ["created_at", "2026-02-02 17:27:33.278549"], ["updated_at", "2026-02-02 17:27:33.278549"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCheckin Pluck (0.5ms)[0m  [1m[34mSELECT "checkins"."occurred_on" FROM "checkins" WHERE "checkins"."habit_id" = $1 AND (occurred_on <= '2026-02-02')[0m  [["habit_id", 9]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------
StreakCalculatorTest: test_calculates_longest_streak_correctly
--------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-02-02 17:27:33.282469"], ["updated_at", "2026-02-02 17:27:33.282469"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.3ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 10], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2026-01-03"], ["archived_at", nil], ["color", nil], ["created_at", "2026-02-02 17:27:33.283233"], ["updated_at", "2026-02-02 17:27:33.283233"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-23"], ["habit_id", 10], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.5ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 10], ["user_id", 10], ["occurred_on", "2026-01-23"], ["created_at", "2026-02-02 17:27:33.285051"], ["updated_at", "2026-02-02 17:27:33.285051"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-24"], ["habit_id", 10], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.3ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 10], ["user_id", 10], ["occurred_on", "2026-01-24"], ["created_at", "2026-02-02 17:27:33.286522"], ["updated_at", "2026-02-02 17:27:33.286522"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-25"], ["habit_id", 10], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.5ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 10], ["user_id", 10], ["occurred_on", "2026-01-25"], ["created_at", "2026-02-02 17:27:33.287814"], ["updated_at", "2026-02-02 17:27:33.287814"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-27"], ["habit_id", 10], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.3ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 10], ["user_id", 10], ["occurred_on", "2026-01-27"], ["created_at", "2026-02-02 17:27:33.289255"], ["updated_at", "2026-02-02 17:27:33.289255"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-01-28"], ["habit_id", 10], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.2ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 10], ["user_id", 10], ["occurred_on", "2026-01-28"], ["created_at", "2026-02-02 17:27:33.290633"], ["updated_at", "2026-02-02 17:27:33.290633"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCheckin Pluck (0.2ms)[0m  [1m[34mSELECT "checkins"."occurred_on" FROM "checkins" WHERE "checkins"."habit_id" = $1 AND (occurred_on <= '2026-02-02')[0m  [["habit_id", 10]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------
CheckinTest: test_prevents_duplicate_checkins_for_same_habit_and_date
---------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-02-02 17:27:33.294454"], ["updated_at", "2026-02-02 17:27:33.294454"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.8ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 11], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2026-02-02"], ["archived_at", nil], ["color", nil], ["created_at", "2026-02-02 17:27:33.295672"], ["updated_at", "2026-02-02 17:27:33.295672"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-02-02"], ["habit_id", 11], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.4ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 11], ["user_id", 11], ["occurred_on", "2026-02-02"], ["created_at", "2026-02-02 17:27:33.297917"], ["updated_at", "2026-02-02 17:27:33.297917"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-02-02"], ["habit_id", 11], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------
CheckinTest: test_toggle_creates_checkin_when_none_exists
---------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-02-02 17:27:33.302980"], ["updated_at", "2026-02-02 17:27:33.302980"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.6ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 12], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2026-02-02"], ["archived_at", nil], ["color", nil], ["created_at", "2026-02-02 17:27:33.303905"], ["updated_at", "2026-02-02 17:27:33.303905"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCheckin Count (1.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "checkins"[0m
  [1m[36mCheckin Load (0.3ms)[0m  [1m[34mSELECT "checkins".* FROM "checkins" WHERE "checkins"."habit_id" = $1 AND "checkins"."user_id" = $2 AND "checkins"."occurred_on" = $3 LIMIT $4[0m  [["habit_id", 12], ["user_id", 12], ["occurred_on", "2026-02-02"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-02-02"], ["habit_id", 12], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.4ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 12], ["user_id", 12], ["occurred_on", "2026-02-02"], ["created_at", "2026-02-02 17:27:33.308985"], ["updated_at", "2026-02-02 17:27:33.308985"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCheckin Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "checkins"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
CheckinTest: test_allows_checkins_for_same_date_on_different_habits
-------------------------------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.5ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-02-02 17:27:33.313543"], ["updated_at", "2026-02-02 17:27:33.313543"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.3ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 13], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2026-02-02"], ["archived_at", nil], ["color", nil], ["created_at", "2026-02-02 17:27:33.314654"], ["updated_at", "2026-02-02 17:27:33.314654"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.3ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 13], ["name", "Another Habit"], ["goal_per_week", 5], ["start_date", "2026-02-02"], ["archived_at", nil], ["color", nil], ["created_at", "2026-02-02 17:27:33.315578"], ["updated_at", "2026-02-02 17:27:33.315578"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-02-02"], ["habit_id", 13], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.5ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 13], ["user_id", 13], ["occurred_on", "2026-02-02"], ["created_at", "2026-02-02 17:27:33.317299"], ["updated_at", "2026-02-02 17:27:33.317299"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-02-02"], ["habit_id", 14], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.3ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 14], ["user_id", 13], ["occurred_on", "2026-02-02"], ["created_at", "2026-02-02 17:27:33.318953"], ["updated_at", "2026-02-02 17:27:33.318953"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------
CheckinTest: test_toggle_is_idempotent
--------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-02-02 17:27:33.322253"], ["updated_at", "2026-02-02 17:27:33.322253"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.2ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 14], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2026-02-02"], ["archived_at", nil], ["color", nil], ["created_at", "2026-02-02 17:27:33.323003"], ["updated_at", "2026-02-02 17:27:33.323003"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCheckin Load (0.3ms)[0m  [1m[34mSELECT "checkins".* FROM "checkins" WHERE "checkins"."habit_id" = $1 AND "checkins"."user_id" = $2 AND "checkins"."occurred_on" = $3 LIMIT $4[0m  [["habit_id", 15], ["user_id", 14], ["occurred_on", "2026-02-02"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-02-02"], ["habit_id", 15], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.5ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 15], ["user_id", 14], ["occurred_on", "2026-02-02"], ["created_at", "2026-02-02 17:27:33.325411"], ["updated_at", "2026-02-02 17:27:33.325411"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCheckin Count (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "checkins"[0m
  [1m[36mCheckin Load (0.5ms)[0m  [1m[34mSELECT "checkins".* FROM "checkins" WHERE "checkins"."habit_id" = $1 AND "checkins"."user_id" = $2 AND "checkins"."occurred_on" = $3 LIMIT $4[0m  [["habit_id", 15], ["user_id", 14], ["occurred_on", "2026-02-02"], ["LIMIT", 1]]
  [1m[36mCACHE Checkin Count (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "checkins"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------
CheckinTest: test_can_destroy_and_recreate_checkin
--------------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-02-02 17:27:33.331159"], ["updated_at", "2026-02-02 17:27:33.331159"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.3ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 15], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2026-02-02"], ["archived_at", nil], ["color", nil], ["created_at", "2026-02-02 17:27:33.332398"], ["updated_at", "2026-02-02 17:27:33.332398"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-02-02"], ["habit_id", 16], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.8ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 16], ["user_id", 15], ["occurred_on", "2026-02-02"], ["created_at", "2026-02-02 17:27:33.333887"], ["updated_at", "2026-02-02 17:27:33.333887"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Destroy (1.2ms)[0m  [1m[31mDELETE FROM "checkins" WHERE "checkins"."id" = $1[0m  [["id", 28]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCheckin Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "checkins" WHERE "checkins"."occurred_on" = $1 AND "checkins"."habit_id" = $2 LIMIT $3[0m  [["occurred_on", "2026-02-02"], ["habit_id", 16], ["LIMIT", 1]]
  [1m[36mCheckin Create (0.7ms)[0m  [1m[32mINSERT INTO "checkins" ("habit_id", "user_id", "occurred_on", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["habit_id", 16], ["user_id", 15], ["occurred_on", "2026-02-02"], ["created_at", "2026-02-02 17:27:33.338916"], ["updated_at", "2026-02-02 17:27:33.338916"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------
ReminderMailerTest: test_reminder
---------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-02-02 17:27:33.345096"], ["updated_at", "2026-02-02 17:27:33.345096"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.3ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 16], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2026-02-02"], ["archived_at", nil], ["color", nil], ["created_at", "2026-02-02 17:27:33.346072"], ["updated_at", "2026-02-02 17:27:33.346072"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  Rendering layout layouts/mailer.html.erb
  Rendering reminder_mailer/reminder.html.erb within layouts/mailer
  Rendered reminder_mailer/reminder.html.erb within layouts/mailer (Duration: 1.7ms | Allocations: 541)
  Rendered layout layouts/mailer.html.erb (Duration: 2.1ms | Allocations: 739)
  Rendering layout layouts/mailer.text.erb
  Rendering reminder_mailer/reminder.text.erb within layouts/mailer
  Rendered reminder_mailer/reminder.text.erb within layouts/mailer (Duration: 0.4ms | Allocations: 284)
  Rendered layout layouts/mailer.text.erb (Duration: 0.7ms | Allocations: 432)
ReminderMailer#reminder: processed outbound mail in 6.9ms
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
WeeklySummaryMailerTest: test_summary
-------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "test@example.com"], ["LIMIT", 1]]
  [1m[36mUser Create (0.7ms)[0m  [1m[32mINSERT INTO "users" ("name", "email", "password_digest", "timezone", "weekly_summary_enabled", "reminders_enabled", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "Test User"], ["email", "test@example.com"], ["password_digest", "[FILTERED]"], ["timezone", "America/Sao_Paulo"], ["weekly_summary_enabled", true], ["reminders_enabled", true], ["created_at", "2026-02-02 17:27:33.359918"], ["updated_at", "2026-02-02 17:27:33.359918"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mHabit Create (0.4ms)[0m  [1m[32mINSERT INTO "habits" ("user_id", "name", "goal_per_week", "start_date", "archived_at", "color", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 17], ["name", "Test Habit"], ["goal_per_week", 7], ["start_date", "2026-02-02"], ["archived_at", nil], ["color", nil], ["created_at", "2026-02-02 17:27:33.361298"], ["updated_at", "2026-02-02 17:27:33.361298"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  Rendering layout layouts/mailer.html.erb
  Rendering weekly_summary_mailer/summary.html.erb within layouts/mailer
  Rendered weekly_summary_mailer/summary.html.erb within layouts/mailer (Duration: 0.9ms | Allocations: 515)
  Rendered layout layouts/mailer.html.erb (Duration: 1.0ms | Allocations: 571)
  Rendering layout layouts/mailer.text.erb
  Rendering weekly_summary_mailer/summary.text.erb within layouts/mailer
  Rendered weekly_summary_mailer/summary.text.erb within layouts/mailer (Duration: 0.5ms | Allocations: 398)
  Rendered layout layouts/mailer.text.erb (Duration: 0.6ms | Allocations: 446)
WeeklySummaryMailer#summary: processed outbound mail in 3.9ms
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
