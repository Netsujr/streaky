<div id="<%= dom_id habit_data[:habit] %>" class="group bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg hover:shadow-2xl border border-gray-200/50 p-4 sm:p-5 lg:p-6 transform hover:scale-[1.02] transition-all duration-300 cursor-pointer" data-controller="habit-card" data-habit-card-calendar-url-value="<%= calendar_habit_path(habit_data[:habit]) %>" data-action="click->habit-card#openCalendar">
  <div class="flex items-start justify-between mb-4 sm:mb-5">
    <div class="flex-1 min-w-0">
      <%= turbo_frame_tag "habit_name_#{habit_data[:habit].id}" do %>
        <div class="flex items-center space-x-2 sm:space-x-3 mb-2">
          <% if habit_data[:habit].color.present? %>
            <div class="w-3 h-3 sm:w-4 rounded-full bg-<%= habit_data[:habit].color %>-500 shadow-sm flex-shrink-0"></div>
          <% end %>
          <h3 class="text-lg sm:text-xl font-bold text-gray-900 truncate"><%= habit_data[:habit].name %></h3>
        </div>
        <%= link_to "Edit", edit_habit_path(habit_data[:habit]), data: { turbo_frame: "habit_form" }, onclick: "const modal = document.getElementById('habit-form-modal'); if (modal) modal.classList.remove('hidden');", class: "text-xs sm:text-sm text-indigo-600 hover:text-indigo-700 font-medium touch-manipulation" %>
      <% end %>
      <%= turbo_frame_tag "habit_name_#{habit_data[:habit].id}_edit", target: "_top" do %>
      <% end %>
    </div>
    <div class="flex items-center space-x-1">
      <%= link_to "#",
          data: {
            controller: "confirmation-modal",
            action: "click->confirmation-modal#show",
            confirm_title: "Archive Habit",
            confirm_message: "Are you sure you want to archive '#{habit_data[:habit].name}'? You can restore it later from the Archived page.",
            url: archive_habit_path(habit_data[:habit]),
            method: "patch"
          },
          class: "p-2 rounded-lg text-gray-400 hover:text-gray-600 hover:bg-gray-100 transition-colors touch-manipulation flex-shrink-0",
          title: "Archive" do %>
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"></path>
        </svg>
      <% end %>
      <%= link_to "#",
          data: {
            controller: "confirmation-modal",
            action: "click->confirmation-modal#show",
            confirm_title: "Delete Habit",
            confirm_message: "Are you sure you want to permanently delete '#{habit_data[:habit].name}'? This action cannot be undone and will delete all associated check-ins.",
            url: habit_path(habit_data[:habit]),
            method: "delete"
          },
          class: "p-2 rounded-lg text-red-400 hover:text-red-600 hover:bg-red-50 transition-colors touch-manipulation flex-shrink-0",
          title: "Delete" do %>
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
        </svg>
      <% end %>
    </div>
  </div>

  <div class="mb-4 sm:mb-6 grid grid-cols-2 gap-2 sm:gap-3 lg:gap-4">
    <div class="min-w-0 bg-gradient-to-br from-indigo-50 to-indigo-100 rounded-xl p-4 sm:p-5 lg:p-6 text-center border border-indigo-200/50">
      <p class="text-xs font-semibold text-indigo-700 uppercase tracking-wide mb-1">Current</p>
      <p class="text-2xl sm:text-3xl lg:text-4xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent" id="current-streak-<%= habit_data[:habit].id %>">
        <%= habit_data[:current_streak_days] %>
      </p>
      <p class="text-xs text-indigo-600 mt-1">days</p>
    </div>
    <div class="min-w-0 bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-4 sm:p-5 lg:p-6 text-center border border-gray-200/50">
      <p class="text-xs font-semibold text-gray-700 uppercase tracking-wide mb-1">Longest</p>
      <p class="text-2xl sm:text-3xl lg:text-4xl font-bold text-gray-900">
        <%= habit_data[:longest_streak_days] %>
      </p>
      <p class="text-xs text-gray-600 mt-1">days</p>
    </div>
  </div>

  <div class="mt-4 sm:mt-6">
    <p class="text-xs sm:text-sm font-semibold text-gray-700 mb-2 sm:mb-3 flex items-center">
      <svg class="w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
      </svg>
      Last 7 Days
    </p>
    <div class="grid grid-cols-7 gap-2 sm:gap-2.5">
      <% (0..6).reverse_each do |i| %>
        <% date = dashboard_data[:week_end_date] - i.days %>
        <% checked_in = habit_data[:checked_in_dates].include?(date) %>
        <%= button_to toggle_checkin_path(habit_data[:habit], date: date),
                      method: :post,
                      class: "p-2 sm:p-2.5 lg:p-3 relative aspect-square rounded-lg sm:rounded-xl border-2 transition-all duration-200 transform active:scale-95 sm:hover:scale-110 touch-manipulation #{checked_in ? 'bg-gradient-to-br from-indigo-500 to-purple-600 border-indigo-600 text-white shadow-md' : 'bg-white border-gray-300 text-gray-600 hover:border-indigo-400 hover:bg-indigo-50'}",
                      form_class: "inline" do %>
          <span class="text-xs sm:text-sm font-bold"><%= date.strftime("%d") %></span>
        <% end %>
      <% end %>
    </div>
  </div>
</div>
