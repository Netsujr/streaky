<% habit ||= local_assigns[:habit] %>
<%= form_with model: habit || Habit.new, data: { controller: "habit-form" } do |form| %>
  <div class="mb-6">
    <h2 class="text-2xl font-bold text-gray-900 mb-2"><%= habit&.persisted? ? 'Edit Habit' : 'New Habit' %></h2>
    <p class="text-gray-600 text-sm">Track your progress and build consistency</p>
  </div>

  <% if habit&.errors&.any? %>
    <div class="mb-6 p-4 bg-red-50 border-2 border-red-200 rounded-xl">
      <ul class="list-disc list-inside text-red-700 font-medium space-y-1">
        <% habit.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="mb-5">
    <%= form.label :name, class: "block text-gray-700 font-semibold mb-2 text-sm" %>
    <%= form.text_field :name,
                        required: true,
                        maxlength: 60,
                        placeholder: "e.g., Exercise, Read, Meditate",
                        data: { habit_form_target: "nameField", action: "input->habit-form#validateName" },
                        class: "w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors bg-white" %>
    <p data-habit-form-target="nameError" class="mt-1 text-sm text-red-600 hidden"></p>
  </div>

  <div class="mb-5">
    <%= form.label :goal_per_week, "Goal per week (days)", class: "block text-gray-700 font-semibold mb-2 text-sm" %>
    <%= form.number_field :goal_per_week,
                          in: 1..7,
                          default: 7,
                          class: "w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors bg-white" %>
    <p class="mt-1 text-xs text-gray-500">How many days per week do you want to complete this habit?</p>
  </div>

  <div class="mb-5">
    <%= form.label :start_date, class: "block text-gray-700 font-semibold mb-2 text-sm" %>
    <%= form.date_field :start_date,
                        value: Time.use_zone(current_user.timezone) { Time.zone.today },
                        class: "w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors bg-white" %>
  </div>

  <div class="mb-6">
    <%= form.label :color, class: "block text-gray-700 font-semibold mb-2 text-sm" %>
    <%= form.select :color,
                    options_for_select([
                      ['None', ''],
                      ['Blue', 'blue'],
                      ['Green', 'green'],
                      ['Purple', 'purple'],
                      ['Red', 'red'],
                      ['Orange', 'orange'],
                      ['Yellow', 'yellow'],
                      ['Pink', 'pink'],
                      ['Indigo', 'indigo']
                    ], habit&.color),
                    {},
                    { class: "w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors bg-white" } %>
    <p class="mt-1 text-xs text-gray-500">Choose a color to help identify this habit</p>
  </div>

  <div class="flex flex-col-reverse sm:flex-row items-stretch sm:items-center justify-end gap-2 sm:gap-3 sm:space-x-3 pt-4 border-t border-gray-200">
    <%= link_to "Cancel", root_path, class: "w-full sm:w-auto text-center px-6 py-3 text-gray-700 hover:text-gray-900 hover:bg-gray-100 rounded-xl font-medium transition-colors text-sm sm:text-base touch-manipulation min-h-[44px] flex items-center justify-center" %>
    <%= form.submit habit&.persisted? ? "Update Habit" : "Create Habit", class: "w-full sm:w-auto bg-gradient-to-r from-indigo-600 to-purple-600 text-white px-6 py-3 rounded-xl hover:shadow-lg transform hover:scale-105 transition-all duration-200 font-semibold text-sm sm:text-base touch-manipulation min-h-[44px]" %>
  </div>
<% end %>
